<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Hitung Selisih - Kelas 1 SD</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    
    <!-- Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- Font & Icons -->
    <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;600;700&family=Varela+Round&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Confetti -->
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

    <style>
        body {
            font-family: 'Varela Round', sans-serif;
            background-color: #ecfccb; /* Lime tint */
            background-image: radial-gradient(#a3e635 2px, transparent 2px);
            background-size: 24px 24px;
            overflow: hidden;
            touch-action: none;
            user-select: none;
        }
        
        .font-title { font-family: 'Fredoka', sans-serif; }

        /* Button & Input Styles */
        .num-btn {
            transition: all 0.1s;
        }
        .num-btn:active {
            transform: scale(0.9);
        }

        .input-box {
            font-family: 'Fredoka', sans-serif;
            transition: all 0.3s;
        }
        .input-box.correct {
            background-color: #dcfce7;
            border-color: #22c55e;
            color: #15803d;
        }
        .input-box.wrong {
            background-color: #fee2e2;
            border-color: #ef4444;
            color: #b91c1c;
            animation: shake 0.4s;
        }

        /* Animations */
        @keyframes pop {
            0% { transform: scale(0); opacity: 0; }
            60% { transform: scale(1.2); opacity: 1; }
            100% { transform: scale(1); }
        }
        .animate-pop { animation: pop 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards; }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }
        .animate-shake { animation: shake 0.4s; }
    </style>
</head>
<body class="flex flex-col h-screen">
    <div id="root" class="flex-grow h-full"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // --- 1. ASSETS: SVG ICONS ---
        const Icons = {
            Apple: ({ color }) => (
                <svg viewBox="0 0 100 100" className="w-full h-full drop-shadow-sm">
                    <path d="M50 20 Q 65 5 80 20 Q 95 35 85 65 Q 75 95 50 90 Q 25 95 15 65 Q 5 35 20 20 Q 35 5 50 20" fill={color} />
                    <path d="M50 20 Q 50 5 55 10" stroke="#4a7c59" strokeWidth="4" fill="none" />
                </svg>
            ),
            Car: ({ color }) => (
                <svg viewBox="0 0 100 60" className="w-full h-full drop-shadow-sm">
                    <path d="M10 35 L20 15 L75 15 L85 35 L90 35 Q 95 35 95 45 L95 50 L5 50 L5 45 Q 5 35 10 35 Z" fill={color} />
                    <circle cx="25" cy="50" r="8" fill="#333" />
                    <circle cx="75" cy="50" r="8" fill="#333" />
                </svg>
            ),
            Star: ({ color }) => (
                <svg viewBox="0 0 100 100" className="w-full h-full drop-shadow-sm">
                    <polygon points="50,5 61,35 95,35 68,55 79,90 50,70 21,90 32,55 5,35 39,35" fill={color} stroke="rgba(0,0,0,0.1)" strokeWidth="2" />
                </svg>
            ),
            Ball: ({ color }) => (
                <svg viewBox="0 0 100 100" className="w-full h-full drop-shadow-sm">
                    <circle cx="50" cy="50" r="45" fill={color} />
                    <path d="M5 50 Q 50 20 95 50" fill="none" stroke="rgba(255,255,255,0.5)" strokeWidth="4" />
                </svg>
            ),
            Cookie: ({ color }) => (
                <svg viewBox="0 0 100 100" className="w-full h-full drop-shadow-sm">
                    <circle cx="50" cy="50" r="40" fill={color} />
                    <circle cx="30" cy="40" r="5" fill="rgba(0,0,0,0.2)" />
                    <circle cx="70" cy="30" r="5" fill="rgba(0,0,0,0.2)" />
                    <circle cx="50" cy="70" r="5" fill="rgba(0,0,0,0.2)" />
                </svg>
            )
        };

        // --- 2. GAME LOGIC ---
        
        const OBJECT_TYPES = ['Apple', 'Car', 'Star', 'Ball', 'Cookie'];
        const COLORS = ["#ef4444", "#3b82f6", "#22c55e", "#eab308", "#a855f7", "#f97316"];

        const getRandom = (arr) => arr[Math.floor(Math.random() * arr.length)];
        const getRandomInt = (min, max) => Math.floor(Math.random() * (max - min + 1)) + min;

        const generateQuestions = (count = 5) => {
            let quests = [];
            for (let i = 0; i < count; i++) {
                const type = getRandom(OBJECT_TYPES);
                const color = getRandom(COLORS);
                
                // Generate numbers for A and B
                let numA = getRandomInt(1, 9);
                let numB = getRandomInt(1, 9);
                
                while(numA === numB) {
                    numB = getRandomInt(1, 9);
                }

                const diff = Math.abs(numA - numB);

                quests.push({
                    id: i + 1,
                    type,
                    color,
                    numA,
                    numB,
                    diff
                });
            }
            return quests;
        };

        // FUNGSI SUARA DIPERBAIKI
        const speak = (text) => {
            if ('speechSynthesis' in window) {
                window.speechSynthesis.cancel(); // Reset antrian suara
                const utterance = new SpeechSynthesisUtterance(text);
                utterance.lang = 'id-ID';
                utterance.rate = 0.9;
                utterance.volume = 1.0;
                window.speechSynthesis.speak(utterance);
            }
        };

        // --- 3. COMPONENTS ---

        // Number Input Component
        const NumberControl = ({ value, onChange, label, isCorrect, isWrong, highlightColor }) => {
            const handleUp = () => {
                if (value < 20) onChange(value + 1);
            };
            
            const handleDown = () => {
                if (value > 0) onChange(value - 1);
            };

            let statusClass = "bg-white text-gray-800 border-gray-300";
            if (isCorrect) statusClass = "correct";
            else if (isWrong) statusClass = "wrong";
            else statusClass = highlightColor || "border-gray-300";

            return (
                <div className="flex flex-col items-center gap-1">
                    <button 
                        onClick={handleUp}
                        className="num-btn w-14 h-10 bg-white text-gray-700 rounded-t-xl hover:bg-gray-100 flex items-center justify-center shadow-sm border border-b-0 border-gray-400"
                    >
                        <i className="fa-solid fa-chevron-up text-lg"></i>
                    </button>

                    <div className={`input-box w-24 h-24 rounded-2xl border-[5px] flex items-center justify-center text-5xl font-bold shadow-inner ${statusClass}`}>
                        {value}
                    </div>

                    <button 
                        onClick={handleDown}
                        className="num-btn w-14 h-10 bg-white text-gray-700 rounded-b-xl hover:bg-gray-100 flex items-center justify-center shadow-sm border border-t-0 border-gray-400"
                    >
                        <i className="fa-solid fa-chevron-down text-lg"></i>
                    </button>
                    
                    <span className="text-sm font-black text-gray-600 uppercase tracking-wider mt-1 text-center max-w-[100px] bg-white/80 px-2 rounded border border-gray-200">{label}</span>
                </div>
            );
        };

        // Visual Object Container
        const ObjectBox = ({ type, color, count, label, borderColor }) => {
            const Icon = Icons[type];
            return (
                <div className={`bg-white/90 p-2 rounded-3xl border-[6px] shadow-lg flex flex-col items-center justify-center w-full h-48 md:h-64 relative overflow-hidden ${borderColor}`}>
                    <div className={`absolute top-0 left-0 px-5 py-2 rounded-br-2xl font-black text-lg text-white shadow-md ${borderColor.replace('border-', 'bg-')}`}>
                        {label}
                    </div>
                    <div className="flex flex-wrap justify-center gap-2 content-center h-full w-full p-4 overflow-hidden pt-10">
                        {[...Array(count)].map((_, i) => (
                            <div key={i} className="w-10 h-10 md:w-14 md:h-14 animate-pop" style={{animationDelay: `${i * 0.1}s`}}>
                                <Icon color={color} />
                            </div>
                        ))}
                    </div>
                </div>
            );
        };

        // --- 4. MAIN APP ---
        const App = () => {
            const [screen, setScreen] = useState('start');
            const [questions, setQuestions] = useState([]);
            const [qIndex, setQIndex] = useState(0);
            
            // User Inputs
            const [inputA, setInputA] = useState(0);
            const [inputB, setInputB] = useState(0);
            const [inputC, setInputC] = useState(0);
            
            const [feedback, setFeedback] = useState(null); // null, correct, wrong

            useEffect(() => {
                setQuestions(generateQuestions());
            }, []);

            const currentQ = questions[qIndex];

            // Efek suara saat soal berubah
            useEffect(() => {
                if (screen === 'playing' && currentQ) {
                    // Delay sedikit agar UI siap
                    setTimeout(() => {
                        speak("Hitung benda di kotak A dan B, lalu hitung selisihnya.");
                    }, 500);
                }
            }, [qIndex, screen]);

            const handleStart = () => {
                // Pancingan suara agar browser mengizinkan autoplay selanjutnya
                speak("Ayo mulai menghitung!");
                
                setQuestions(generateQuestions(5));
                setQIndex(0);
                resetInputs();
                setScreen('playing');
            };

            const resetInputs = () => {
                setInputA(0);
                setInputB(0);
                setInputC(0);
                setFeedback(null);
            };

            const handleCheck = () => {
                const isACorrect = inputA === currentQ.numA;
                const isBCorrect = inputB === currentQ.numB;
                const isCCorrect = inputC === currentQ.diff;

                if (isACorrect && isBCorrect && isCCorrect) {
                    setFeedback('correct');
                    speak("Hebat! Jawabanmu benar.");
                    confetti({ particleCount: 100, spread: 70, origin: { y: 0.6 } });
                    
                    setTimeout(() => {
                        if (qIndex < 4) {
                            setQIndex(prev => prev + 1);
                            resetInputs();
                        } else {
                            setScreen('finish');
                            speak("Selamat! Kamu sudah menyelesaikan semua soal.");
                        }
                    }, 2500);
                } else {
                    setFeedback('wrong');
                    speak("Coba periksa lagi hitunganmu.");
                    setTimeout(() => setFeedback(null), 1500);
                }
            };

            // START SCREEN
            if (screen === 'start') {
                return (
                    <div className="h-full flex flex-col items-center justify-center p-4 text-center relative bg-lime-50">
                        <h1 className="text-5xl md:text-7xl font-black text-lime-600 mb-6 font-title drop-shadow-md tracking-wide">
                            HITUNG SELISIH
                        </h1>
                        <p className="text-2xl text-gray-700 mb-10 max-w-lg font-bold">
                            Cari tahu beda jumlah benda di Kotak A dan Kotak B!
                        </p>
                        
                        <button onClick={handleStart} className="bg-orange-500 hover:bg-orange-600 text-white text-3xl font-black py-5 px-20 rounded-full shadow-2xl transform transition hover:scale-105 active:scale-95 border-b-8 border-orange-700 flex items-center gap-4">
                            <i className="fa-solid fa-play"></i> MULAI
                        </button>
                    </div>
                );
            }

            // FINISH SCREEN
            if (screen === 'finish') {
                return (
                    <div className="h-full flex flex-col items-center justify-center p-4 text-center bg-yellow-50">
                        <div className="text-9xl mb-6 animate-bounce">üèÜ</div>
                        <h1 className="text-6xl font-black text-orange-600 mb-4 font-title">SELESAI!</h1>
                        <p className="text-2xl text-gray-700 mb-10 font-bold">Kamu pintar menghitung selisih!</p>
                        <button onClick={handleStart} className="bg-lime-600 hover:bg-lime-700 text-white text-xl font-bold py-4 px-12 rounded-full shadow-lg transform transition hover:scale-105 border-b-8 border-lime-800 flex items-center gap-3">
                            <i className="fa-solid fa-rotate-right"></i> Main Lagi
                        </button>
                        <div className="mt-12">
                            <p className="text-gray-500 text-sm font-bold">
                                Dibuat oleh <span className="text-lime-600">Abdul Salim Owner folderosn.com</span>
                            </p>
                            <a href="https://pakabdulsalim.blogspot.com/" target="_blank" className="text-blue-500 text-sm font-bold hover:underline">Kunjungi: https://pakabdulsalim.blogspot.com</a>
                        </div>
                    </div>
                );
            }

            // PLAYING SCREEN
            return (
                <div className="flex flex-col h-full bg-lime-50 overflow-hidden relative">
                    
                    {/* Header */}
                    <div className="bg-white p-4 shadow-md z-20 flex justify-between items-center border-b-4 border-lime-200">
                        <button onClick={() => setScreen('start')} className="text-gray-500 hover:text-gray-700 bg-gray-100 p-3 rounded-xl shadow active:scale-95">
                            <i className="fa-solid fa-house text-2xl"></i>
                        </button>
                        <h2 className="text-3xl font-black text-lime-700 font-title tracking-wide">Soal {qIndex + 1} / 5</h2>
                        <button onClick={() => speak("Hitung dan cari selisihnya!")} className="bg-white p-3 rounded-full shadow text-lime-600 hover:text-lime-800 border-2 border-lime-100 active:scale-95">
                            <i className="fa-solid fa-volume-high text-2xl"></i>
                        </button>
                    </div>

                    {/* Main Content */}
                    <div className="flex-grow flex flex-col items-center justify-center p-2 gap-4 w-full max-w-6xl mx-auto overflow-y-auto">
                        
                        {/* Visual Row (Boxes A & B) */}
                        <div className="flex w-full gap-4 items-center justify-center px-4">
                            <div className="flex-1">
                                <ObjectBox 
                                    type={currentQ.type} 
                                    color={currentQ.color} 
                                    count={currentQ.numA} 
                                    label="KOTAK A" 
                                    borderColor="border-orange-400"
                                />
                            </div>
                            
                            <div className="text-5xl font-black text-gray-400 hidden md:block opacity-50">VS</div>
                            
                            <div className="flex-1">
                                <ObjectBox 
                                    type={currentQ.type} 
                                    color={currentQ.color} 
                                    count={currentQ.numB} 
                                    label="KOTAK B" 
                                    borderColor="border-blue-400"
                                />
                            </div>
                        </div>

                        {/* Controls Row (Inputs A, B, C) */}
                        <div className="bg-white p-6 rounded-[2rem] shadow-2xl w-full flex flex-col md:flex-row items-center justify-around gap-6 border-b-8 border-lime-200 mx-4">
                            
                            <div className="flex gap-8 md:gap-16 justify-center w-full items-end">
                                {/* Input A */}
                                <NumberControl 
                                    value={inputA} 
                                    onChange={setInputA} 
                                    label="ISIKAN A" 
                                    isCorrect={feedback === 'correct'}
                                    isWrong={feedback === 'wrong' && inputA !== currentQ.numA}
                                    highlightColor="border-orange-300 text-orange-700"
                                />

                                {/* Input B */}
                                <NumberControl 
                                    value={inputB} 
                                    onChange={setInputB} 
                                    label="ISIKAN B" 
                                    isCorrect={feedback === 'correct'}
                                    isWrong={feedback === 'wrong' && inputB !== currentQ.numB}
                                    highlightColor="border-blue-300 text-blue-700"
                                />
                            </div>

                            {/* Decoration Arrow */}
                            <div className="hidden md:block text-gray-300 animate-pulse">
                                <i className="fa-solid fa-arrow-right text-4xl"></i>
                            </div>

                            {/* Input C (Difference) - ENHANCED LABEL */}
                            <div className="bg-yellow-50 p-6 rounded-3xl border-4 border-yellow-400 shadow-inner relative mt-6 md:mt-0">
                                <div className="absolute -top-5 left-1/2 transform -translate-x-1/2 bg-yellow-400 text-yellow-950 text-lg font-black px-6 py-1 rounded-full shadow-md border-2 border-white tracking-widest whitespace-nowrap">
                                    SELISIH
                                </div>
                                <div className="mt-2">
                                    <NumberControl 
                                        value={inputC} 
                                        onChange={setInputC} 
                                        label="BEDA BERAPA?" 
                                        isCorrect={feedback === 'correct'}
                                        isWrong={feedback === 'wrong' && inputC !== currentQ.diff}
                                        highlightColor="border-yellow-600 text-yellow-800"
                                    />
                                </div>
                            </div>

                        </div>

                        {/* Check Button */}
                        <button 
                            onClick={handleCheck}
                            className="bg-lime-500 hover:bg-lime-600 text-white text-2xl font-bold py-4 px-16 rounded-full shadow-lg transform transition hover:scale-105 active:scale-95 border-b-8 border-lime-700 w-full md:w-auto mb-2 flex items-center justify-center gap-3"
                        >
                            <i className="fa-solid fa-check-circle"></i> CEK JAWABAN
                        </button>

                    </div>

                    {/* Footer */}
                    <footer className="bg-white border-t-4 border-lime-300 py-3 z-20">
                        <div className="container mx-auto text-center">
                            <p className="text-gray-600 text-xs md:text-sm font-bold">
                                Dibuat oleh <span className="text-lime-600">Abdul Salim Owner folderosn.com</span>
                            </p>
                            <a href="https://pakabdulsalim.blogspot.com/" target="_blank" className="inline-block text-blue-500 hover:text-blue-700 font-bold hover:underline transition-all text-xs">
                                Kunjungi: https://pakabdulsalim.blogspot.com
                            </a>
                        </div>
                    </footer>

                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
