<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cerita Pengurangan Kelas 1 SD</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    
    <!-- Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- Font & Icons -->
    <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;600;700&family=Comic+Neue:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Confetti -->
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

    <style>
        body {
            font-family: 'Comic Neue', cursive;
            background-color: #fdf2f8; /* Pinkish white */
            background-image: radial-gradient(#fbcfe8 2px, transparent 2px);
            background-size: 30px 30px;
            user-select: none;
        }
        
        .font-title { font-family: 'Fredoka', sans-serif; }

        /* Input Styles */
        .math-input {
            border: 3px solid #db2777;
            border-radius: 12px;
            text-align: center;
            font-family: 'Fredoka', sans-serif;
            font-size: 2rem;
            color: #be185d;
            width: 70px;
            height: 70px;
            transition: all 0.3s;
            background: white;
        }
        .math-input:focus {
            outline: none;
            box-shadow: 0 0 0 4px rgba(219, 39, 119, 0.3);
            transform: scale(1.05);
        }
        .math-input.correct {
            border-color: #22c55e;
            background-color: #f0fdf4;
            color: #15803d;
        }
        
        /* Animations */
        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-5px); }
        }
        .animate-float { animation: float 3s ease-in-out infinite; }

        @keyframes flyAway {
            0% { transform: translate(0, 0) scale(1); opacity: 1; }
            100% { transform: translate(100px, -100px) scale(0.5); opacity: 0; }
        }
        .animate-fly { animation: flyAway 1s ease-in forwards; }

        @keyframes pop {
            0% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.2); opacity: 1; }
            100% { transform: scale(0); opacity: 0; }
        }
        .animate-pop-vanish { animation: pop 0.5s ease-out forwards; }

        @keyframes fadeDown {
            0% { transform: translateY(0); opacity: 1; }
            100% { transform: translateY(20px); opacity: 0.2; }
        }
        .animate-eat { animation: fadeDown 0.5s ease-in forwards; }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }
        .animate-shake { animation: shake 0.4s; }
    </style>
</head>
<body class="flex flex-col min-h-screen">
    <div id="root" class="flex-grow"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // --- 1. ASSETS (SVG ICONS) ---
        const Icons = {
            Egg: ({ color, state }) => (
                <svg viewBox="0 0 100 100" className={`w-12 h-12 md:w-16 md:h-16 inline-block m-1 transition-all duration-500 ${state === 'gone' ? 'opacity-30 grayscale' : 'animate-float'}`}>
                    {state === 'gone' ? (
                        // Broken Egg
                        <g>
                            <path d="M20 70 L40 50 L60 70 L80 50 L80 80 Q 50 95 20 80 Z" fill="#e5e7eb" stroke="#9ca3af" strokeWidth="2" />
                            <path d="M20 70 L40 50 L60 70 L80 50 L80 40 Q 50 10 20 40 Z" fill="#f3f4f6" stroke="#9ca3af" strokeWidth="2" transform="translate(5, -20) rotate(10)" />
                        </g>
                    ) : (
                        // Whole Egg
                        <path d="M50 5 Q 90 35 90 65 Q 90 95 50 95 Q 10 95 10 65 Q 10 35 50 5" fill="#fef3c7" stroke="#fde68a" strokeWidth="2" />
                    )}
                </svg>
            ),
            Bird: ({ color, state }) => (
                <svg viewBox="0 0 100 100" className={`w-12 h-12 md:w-16 md:h-16 inline-block m-1 ${state === 'gone' ? 'animate-fly' : 'animate-float'}`}>
                    <path d="M20 60 Q 20 30 50 30 Q 80 30 80 60 Q 80 90 50 90 Q 20 90 20 60" fill="#3b82f6" />
                    <polygon points="80,45 95,50 80,55" fill="#facc15" />
                    <circle cx="65" cy="45" r="4" fill="black" />
                    <path d="M20 60 Q 10 50 10 70" stroke="#3b82f6" strokeWidth="5" fill="none" />
                    {/* Wing */}
                    <path d="M40 60 Q 55 40 70 60" fill="#60a5fa" />
                </svg>
            ),
            Balloon: ({ color, state }) => (
                <svg viewBox="0 0 100 100" className={`w-12 h-12 md:w-16 md:h-16 inline-block m-1 ${state === 'gone' ? 'animate-pop-vanish' : 'animate-float'}`}>
                    <line x1="50" y1="80" x2="50" y2="95" stroke="#999" strokeWidth="2" />
                    <ellipse cx="50" cy="45" rx="35" ry="40" fill="#f472b6" />
                    <ellipse cx="35" cy="30" rx="8" ry="12" fill="rgba(255,255,255,0.4)" transform="rotate(-30 35 30)" />
                    <polygon points="50,85 45,90 55,90" fill="#f472b6" />
                </svg>
            ),
            Apple: ({ color, state }) => (
                <svg viewBox="0 0 100 100" className={`w-12 h-12 md:w-16 md:h-16 inline-block m-1 transition-all duration-500 ${state === 'gone' ? 'opacity-20 scale-75' : 'animate-float'}`}>
                    {state === 'gone' ? (
                        // Eaten Apple Core
                        <g>
                            <path d="M40 20 Q 30 50 40 80 L 60 80 Q 70 50 60 20 Z" fill="#fef9c3" />
                            <path d="M40 20 Q 50 10 60 20" fill="#ef4444" />
                            <path d="M40 80 Q 50 90 60 80" fill="#ef4444" />
                            <path d="M50 20 Q 50 5 55 10" stroke="#4a7c59" strokeWidth="3" fill="none" />
                        </g>
                    ) : (
                        // Whole Apple
                        <g>
                            <path d="M50 20 Q 65 5 80 20 Q 95 35 85 65 Q 75 95 50 90 Q 25 95 15 65 Q 5 35 20 20 Q 35 5 50 20" fill="#ef4444" />
                            <path d="M50 20 Q 50 5 55 10" stroke="#4a7c59" strokeWidth="4" fill="none" />
                        </g>
                    )}
                </svg>
            ),
            Car: ({ color, state }) => (
                <svg viewBox="0 0 100 60" className={`w-12 h-12 md:w-16 md:h-16 inline-block m-1 ${state === 'gone' ? 'animate-fly' : 'animate-float'}`}>
                    <g transform={state === 'gone' ? "translate(20,0)" : ""}>
                        <path d="M10 35 L20 15 L75 15 L85 35 L90 35 Q 95 35 95 45 L95 50 L5 50 L5 45 Q 5 35 10 35 Z" fill="#facc15" />
                        <circle cx="25" cy="50" r="8" fill="#333" />
                        <circle cx="75" cy="50" r="8" fill="#333" />
                    </g>
                </svg>
            )
        };

        // --- 2. LOGIC: STORY GENERATOR ---
        
        const NAMES = ["Budi", "Siti", "Edo", "Lani", "Dayu", "Beni", "Ayah", "Ibu"];
        
        const SCENARIOS = [
            {
                type: 'Egg',
                name: 'telur',
                verbStart: 'membeli',
                verbAction: 'pecah',
                anim: 'gone' // shows broken egg
            },
            {
                type: 'Bird',
                name: 'burung',
                verbStart: 'melihat',
                verbAction: 'terbang',
                anim: 'gone' // fly away animation
            },
            {
                type: 'Balloon',
                name: 'balon',
                verbStart: 'memegang',
                verbAction: 'meletus',
                anim: 'gone' // pop animation
            },
            {
                type: 'Apple',
                name: 'apel',
                verbStart: 'punya',
                verbAction: 'dimakan',
                anim: 'gone' // eaten core
            },
            {
                type: 'Car',
                name: 'mobil mainan',
                verbStart: 'memiliki',
                verbAction: 'hilang',
                anim: 'gone' // drive away
            }
        ];

        const getRandomInt = (min, max) => Math.floor(Math.random() * (max - min + 1)) + min;
        const getRandomItem = (arr) => arr[Math.floor(Math.random() * arr.length)];

        const generateQuestions = (count = 10) => {
            let quests = [];
            for(let i=0; i<count; i++) {
                const person = getRandomItem(NAMES);
                const scenario = getRandomItem(SCENARIOS);
                
                // Logic numbers: Total <= 10
                const total = getRandomInt(2, 10);
                const sub = getRandomInt(1, total - 1); // Ensure result >= 1
                const res = total - sub;

                const text = `${person} ${scenario.verbStart} ${total} ${scenario.name}.`;
                const subText = `${sub} ${scenario.name} ${scenario.verbAction}.`;
                const question = `Berapa sisa ${scenario.name} ${person}?`;

                quests.push({
                    id: i + 1,
                    ...scenario,
                    person,
                    total,
                    sub,
                    res,
                    text,
                    subText,
                    question
                });
            }
            return quests;
        };

        // --- 3. HELPER: TTS ---
        const speak = (text) => {
            if ('speechSynthesis' in window) {
                window.speechSynthesis.cancel();
                const utterance = new SpeechSynthesisUtterance(text);
                utterance.lang = 'id-ID';
                window.speechSynthesis.speak(utterance);
            }
        };

        // --- 4. MAIN COMPONENT ---
        const App = () => {
            const [questions, setQuestions] = useState([]);
            const [idx, setIdx] = useState(0);
            const [input1, setInput1] = useState('');
            const [input2, setInput2] = useState('');
            const [inputRes, setInputRes] = useState('');
            const [status, setStatus] = useState('loading'); // loading, playing, finished
            const [feedback, setFeedback] = useState(null); // correct, wrong

            // Init
            useEffect(() => {
                startNewGame();
            }, []);

            const startNewGame = () => {
                setQuestions(generateQuestions(10));
                setIdx(0);
                setStatus('playing');
                resetInputs();
            };

            const resetInputs = () => {
                setInput1('');
                setInput2('');
                setInputRes('');
                setFeedback(null);
            };

            const q = questions[idx];

            // Auto Read Question
            useEffect(() => {
                if (status === 'playing' && q) {
                    speak(`${q.text} ${q.subText} ${q.question}`);
                }
            }, [idx, status, q]);

            const handleCheck = () => {
                const n1 = parseInt(input1);
                const n2 = parseInt(input2);
                const r = parseInt(inputRes);

                // Check Logic: n1 - n2 = r
                if (n1 === q.total && n2 === q.sub && r === q.res) {
                    setFeedback('correct');
                    speak("Benar! Kamu hebat.");
                    confetti({ particleCount: 100, spread: 70, origin: { y: 0.6 } });
                    
                    setTimeout(() => {
                        if (idx < questions.length - 1) {
                            setIdx(idx + 1);
                            resetInputs();
                        } else {
                            setStatus('finished');
                            speak("Selamat! Kamu sudah menyelesaikan semua soal.");
                        }
                    }, 2000);
                } else {
                    setFeedback('wrong');
                    speak("Coba cek angkanya lagi ya.");
                    setTimeout(() => setFeedback(null), 1000);
                }
            };

            const IconComp = q ? Icons[q.type] : null;

            if (status === 'loading' || !q) return <div className="min-h-screen flex items-center justify-center text-2xl font-bold text-pink-500">Memuat Soal...</div>;

            // --- SCREEN: FINISHED ---
            if (status === 'finished') {
                return (
                    <div className="min-h-screen flex flex-col">
                        <div className="flex-grow flex flex-col items-center justify-center p-4 text-center bg-pink-50">
                            <div className="text-9xl mb-6 animate-bounce">üèÜ</div>
                            <h1 className="font-title text-5xl text-pink-600 mb-4">Hore! Selesai!</h1>
                            <p className="text-2xl text-gray-600 mb-8">Kamu pintar sekali berhitung!</p>
                            <button 
                                onClick={startNewGame}
                                className="bg-green-500 text-white text-xl font-bold py-4 px-12 rounded-full shadow-lg hover:scale-105 transition border-b-8 border-green-700"
                            >
                                Main Lagi
                            </button>
                        </div>
                        <Footer />
                    </div>
                );
            }

            // --- SCREEN: PLAYING ---
            return (
                <div className="min-h-screen flex flex-col bg-pink-50">
                    <div className="flex-grow flex flex-col items-center py-6 px-4 max-w-3xl mx-auto w-full">
                        
                        {/* Header */}
                        <div className="w-full flex justify-between items-center mb-6">
                            <h1 className="font-title text-2xl md:text-3xl text-pink-600 drop-shadow-sm">Cerita Pengurangan</h1>
                            <div className="bg-white border-2 border-pink-300 px-4 py-2 rounded-full text-pink-500 font-bold shadow-sm">
                                Soal {idx + 1} / 10
                            </div>
                        </div>

                        {/* Main Card */}
                        <div className="bg-white rounded-3xl shadow-xl border-b-8 border-pink-300 w-full p-6 md:p-8 relative overflow-hidden">
                            
                            {/* TTS Button */}
                            <button 
                                onClick={() => speak(`${q.text} ${q.subText} ${q.question}`)}
                                className="absolute top-4 right-4 text-pink-400 hover:text-pink-600 bg-pink-50 p-3 rounded-full shadow-sm transition"
                            >
                                <i className="fa-solid fa-volume-high text-2xl"></i>
                            </button>

                            {/* Story Text */}
                            <div className="mb-8 pr-12">
                                <p className="text-xl md:text-2xl text-gray-700 leading-relaxed mb-4">
                                    {q.text} <br/>
                                    <span className="text-red-500 font-bold">{q.subText}</span>
                                </p>
                                <p className="text-xl md:text-2xl font-bold text-pink-600 bg-pink-50 inline-block px-4 py-2 rounded-xl border border-pink-100">
                                    {q.question}
                                </p>
                            </div>

                            {/* Visual Animation Area */}
                            <div className="bg-blue-50 rounded-2xl border-2 border-blue-100 p-6 mb-8 min-h-[150px] flex flex-wrap justify-center items-center gap-2 relative">
                                {/* Render Total Objects */}
                                {[...Array(q.total)].map((_, i) => {
                                    // Determine state: 'gone' for the last X items (where X is q.sub)
                                    // Example: Total 8, Sub 3. Indices 5, 6, 7 should be 'gone'.
                                    const isGone = i >= (q.total - q.sub);
                                    return (
                                        <div key={i} className="relative">
                                            <IconComp state={isGone ? 'gone' : 'normal'} />
                                        </div>
                                    );
                                })}
                            </div>

                            {/* Math Input Area */}
                            <div className="bg-yellow-50 rounded-2xl p-6 border-2 border-yellow-200 text-center">
                                <p className="text-gray-500 font-bold mb-4 uppercase tracking-wider text-sm">Tulis Kalimat Matematikanya</p>
                                
                                <div className="flex flex-wrap justify-center items-center gap-2 md:gap-4">
                                    <input 
                                        type="number" 
                                        value={input1} 
                                        onChange={(e) => setInput1(e.target.value)}
                                        className={`math-input ${feedback === 'correct' ? 'correct' : ''}`}
                                        placeholder="?"
                                    />
                                    <span className="text-4xl md:text-5xl font-black text-gray-400 mx-1">-</span>
                                    <input 
                                        type="number" 
                                        value={input2} 
                                        onChange={(e) => setInput2(e.target.value)}
                                        className={`math-input ${feedback === 'correct' ? 'correct' : ''}`}
                                        placeholder="?"
                                    />
                                    <span className="text-4xl md:text-5xl font-black text-gray-400 mx-1">=</span>
                                    <input 
                                        type="number" 
                                        value={inputRes} 
                                        onChange={(e) => setInputRes(e.target.value)}
                                        className={`math-input ${feedback === 'correct' ? 'correct' : ''}`}
                                        placeholder="?"
                                    />
                                </div>
                            </div>

                            {/* Action Button */}
                            <div className="mt-8 text-center">
                                <button 
                                    onClick={handleCheck}
                                    className="bg-pink-500 hover:bg-pink-600 text-white text-2xl font-bold py-3 px-12 rounded-full shadow-lg transform transition active:scale-95 border-b-4 border-pink-700 w-full md:w-auto"
                                >
                                    Cek Jawaban
                                </button>
                            </div>

                            {/* Feedback Overlay */}
                            {feedback === 'wrong' && (
                                <div className="absolute inset-0 flex items-center justify-center bg-white/80 z-50 animate-pop-vanish">
                                    <div className="bg-red-100 px-8 py-6 rounded-3xl border-4 border-red-300 text-center shadow-2xl animate-shake">
                                        <div className="text-6xl mb-2">üò¢</div>
                                        <h2 className="text-3xl font-bold text-red-500">Coba Lagi Yuk!</h2>
                                    </div>
                                </div>
                            )}

                        </div>
                    </div>
                    <Footer />
                </div>
            );
        };

        // --- FOOTER COMPONENT ---
        const Footer = () => (
            <footer className="bg-white border-t-4 border-pink-300 py-6 mt-auto">
                <div className="container mx-auto text-center">
                    <p className="text-gray-600 font-bold text-base md:text-lg mb-1">
                        Dibuat oleh <span className="text-pink-600">Abdul Salim Owner folderosn.com</span>
                    </p>
                    <a 
                        href="https://pakabdulsalim.blogspot.com" 
                        target="_blank" 
                        rel="noopener noreferrer" 
                        className="inline-block bg-blue-100 text-blue-600 px-4 py-1 rounded-full font-bold hover:bg-blue-200 transition"
                    >
                        Kunjungi: https://pakabdulsalim.blogspot.com
                    </a>
                </div>
            </footer>
        );

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
