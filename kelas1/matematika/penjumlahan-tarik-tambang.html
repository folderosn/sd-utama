<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Tarik Tambang Penjumlahan - Kelas 1 SD</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    
    <!-- Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- Font & Icons -->
    <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;600;700&family=Varela+Round&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Confetti -->
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

    <style>
        body {
            font-family: 'Varela Round', sans-serif;
            background-color: #f0f9ff; /* Sky blue tint */
            background-image: radial-gradient(#bae6fd 2px, transparent 2px);
            background-size: 24px 24px;
            overflow: hidden;
            touch-action: none;
            user-select: none;
        }
        
        .font-title { font-family: 'Fredoka', sans-serif; }

        /* Rope Texture */
        .rope {
            background: repeating-linear-gradient(
                45deg,
                #d97706,
                #d97706 10px,
                #b45309 10px,
                #b45309 20px
            );
            box-shadow: 0 4px 6px rgba(0,0,0,0.3);
        }

        /* Button Styles */
        .answer-btn {
            transition: all 0.1s;
            border-bottom-width: 6px;
        }
        .answer-btn:active {
            transform: translateY(4px);
            border-bottom-width: 2px;
        }

        /* Animations */
        @keyframes pop {
            0% { transform: scale(0.5); opacity: 0; }
            60% { transform: scale(1.1); opacity: 1; }
            100% { transform: scale(1); }
        }
        .animate-pop { animation: pop 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards; }

        @keyframes pull-left {
            0% { transform: translateX(0); }
            50% { transform: translateX(-30px); }
            100% { transform: translateX(-10px); } /* Net movement */
        }
        @keyframes pull-right {
            0% { transform: translateX(0); }
            50% { transform: translateX(30px); }
            100% { transform: translateX(10px); } /* Net movement */
        }
        
        .pull-anim-left { animation: pull-left 0.5s ease-in-out; }
        .pull-anim-right { animation: pull-right 0.5s ease-in-out; }

    </style>
</head>
<body class="flex flex-col h-screen">
    <div id="root" class="flex-grow h-full"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // --- 1. ASSETS: SVG ICONS ---
        const Icons = {
            Apple: ({ color }) => (
                <svg viewBox="0 0 100 100" className="w-full h-full drop-shadow-sm">
                    <path d="M50 20 Q 65 5 80 20 Q 95 35 85 65 Q 75 95 50 90 Q 25 95 15 65 Q 5 35 20 20 Q 35 5 50 20" fill={color} />
                    <path d="M50 20 Q 50 5 55 10" stroke="#4a7c59" strokeWidth="4" fill="none" />
                </svg>
            ),
            Car: ({ color }) => (
                <svg viewBox="0 0 100 60" className="w-full h-full drop-shadow-sm">
                    <path d="M10 35 L20 15 L75 15 L85 35 L90 35 Q 95 35 95 45 L95 50 L5 50 L5 45 Q 5 35 10 35 Z" fill={color} />
                    <circle cx="25" cy="50" r="8" fill="#333" />
                    <circle cx="75" cy="50" r="8" fill="#333" />
                </svg>
            ),
            Star: ({ color }) => (
                <svg viewBox="0 0 100 100" className="w-full h-full drop-shadow-sm">
                    <polygon points="50,5 61,35 95,35 68,55 79,90 50,70 21,90 32,55 5,35 39,35" fill={color} stroke="rgba(0,0,0,0.1)" strokeWidth="2" />
                </svg>
            ),
            Ball: ({ color }) => (
                <svg viewBox="0 0 100 100" className="w-full h-full drop-shadow-sm">
                    <circle cx="50" cy="50" r="45" fill={color} />
                    <path d="M5 50 Q 50 20 95 50" fill="none" stroke="rgba(255,255,255,0.5)" strokeWidth="4" />
                </svg>
            ),
            Cookie: ({ color }) => (
                <svg viewBox="0 0 100 100" className="w-full h-full drop-shadow-sm">
                    <circle cx="50" cy="50" r="40" fill={color} />
                    <circle cx="30" cy="40" r="5" fill="rgba(0,0,0,0.2)" />
                    <circle cx="70" cy="30" r="5" fill="rgba(0,0,0,0.2)" />
                    <circle cx="50" cy="70" r="5" fill="rgba(0,0,0,0.2)" />
                </svg>
            ),
            Flower: ({ color }) => (
                <svg viewBox="0 0 100 100" className="w-full h-full drop-shadow-sm">
                    <circle cx="30" cy="30" r="15" fill={color} />
                    <circle cx="70" cy="30" r="15" fill={color} />
                    <circle cx="30" cy="70" r="15" fill={color} />
                    <circle cx="70" cy="70" r="15" fill={color} />
                    <circle cx="50" cy="50" r="20" fill="#facc15" />
                </svg>
            )
        };

        // --- 2. GAME LOGIC ---
        const OBJECT_TYPES = ['Apple', 'Car', 'Star', 'Ball', 'Cookie', 'Flower'];
        const COLORS = ["#ef4444", "#3b82f6", "#22c55e", "#eab308", "#a855f7", "#f97316", "#ec4899"];

        const getRandom = (arr) => arr[Math.floor(Math.random() * arr.length)];
        const getRandomInt = (min, max) => Math.floor(Math.random() * (max - min + 1)) + min;

        const generateQuestions = (count = 5) => {
            let quests = [];
            for (let i = 0; i < count; i++) {
                const type = getRandom(OBJECT_TYPES);
                const color = getRandom(COLORS);
                
                const numA = getRandomInt(1, 10);
                const numB = getRandomInt(1, 10);
                const total = numA + numB;

                // Generate Options (1 Correct, 2 Distractors)
                const opts = new Set([total]);
                while(opts.size < 3) {
                    let distractor = getRandomInt(Math.max(2, total - 5), Math.min(20, total + 5));
                    if (distractor !== total) opts.add(distractor);
                }

                quests.push({
                    id: i + 1,
                    type,
                    color,
                    numA,
                    numB,
                    total,
                    options: Array.from(opts).sort((a, b) => a - b)
                });
            }
            return quests;
        };

        const speak = (text) => {
            if ('speechSynthesis' in window) {
                window.speechSynthesis.cancel();
                const utterance = new SpeechSynthesisUtterance(text);
                utterance.lang = 'id-ID';
                utterance.rate = 0.9;
                window.speechSynthesis.speak(utterance);
            }
        };

        // --- 3. COMPONENTS ---

        const ObjectBox = ({ type, color, count }) => {
            const Icon = Icons[type];
            return (
                <div className="bg-white/80 p-1 rounded-2xl border-2 border-blue-200 shadow-inner flex flex-wrap justify-center content-center gap-1 w-full h-24 md:h-32 overflow-hidden">
                    {[...Array(count)].map((_, i) => (
                        <div key={i} className="w-6 h-6 md:w-8 md:h-8 animate-pop" style={{animationDelay: `${i * 0.05}s`}}>
                            <Icon color={color} />
                        </div>
                    ))}
                </div>
            );
        };

        const PlayerPanel = ({ side, score, options, onAnswer, disabled, isWinner }) => {
            const bgClass = side === 'left' ? 'bg-red-100 border-red-300' : 'bg-blue-100 border-blue-300';
            const textClass = side === 'left' ? 'text-red-600' : 'text-blue-600';
            const btnClass = side === 'left' ? 'bg-red-500 border-red-700 hover:bg-red-600' : 'bg-blue-500 border-blue-700 hover:bg-blue-600';

            return (
                <div className={`flex-1 flex flex-col p-2 md:p-4 border-r-4 border-white/50 relative ${side === 'left' ? 'items-start' : 'items-end'}`}>
                    {/* Score Badge */}
                    <div className={`absolute top-4 ${side === 'left' ? 'left-4' : 'right-4'} text-2xl font-black ${textClass} bg-white px-4 py-2 rounded-full shadow-lg border-2 ${side === 'left' ? 'border-red-200' : 'border-blue-200'}`}>
                        {score} <i className="fa-solid fa-star text-yellow-400 ml-1"></i>
                    </div>

                    {/* Team Label */}
                    <h2 className={`mt-16 md:mt-12 text-3xl md:text-4xl font-black ${textClass} w-full text-center uppercase tracking-wider drop-shadow-sm`}>
                        TIM {side === 'left' ? 'MERAH' : 'BIRU'}
                    </h2>

                    {/* Options Grid */}
                    <div className="flex-grow flex flex-col justify-center w-full max-w-md mx-auto gap-4 mt-4">
                        {options.map((opt, idx) => (
                            <button 
                                key={idx}
                                onClick={() => onAnswer(side, opt)}
                                disabled={disabled}
                                className={`answer-btn w-full py-4 md:py-6 rounded-2xl text-3xl md:text-5xl font-black text-white shadow-lg border-b-[6px] transform transition active:scale-95 disabled:opacity-50 disabled:cursor-not-allowed ${btnClass}`}
                            >
                                {opt}
                            </button>
                        ))}
                    </div>
                    
                    {isWinner && (
                        <div className="absolute inset-0 bg-white/80 z-50 flex items-center justify-center animate-pop rounded-xl">
                            <div className="text-center">
                                <div className="text-6xl mb-2">üèÜ</div>
                                <div className={`text-4xl font-black ${textClass}`}>MENANG!</div>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        // --- 4. MAIN APP ---
        const App = () => {
            const [screen, setScreen] = useState('start');
            const [questions, setQuestions] = useState([]);
            const [qIndex, setQIndex] = useState(0);
            
            // Game State
            const [ropePosition, setRopePosition] = useState(50); // 0 to 100, 50 is center
            const [scores, setScores] = useState({ left: 0, right: 0 });
            const [roundWinner, setRoundWinner] = useState(null); // 'left', 'right', or null
            const [gameWinner, setGameWinner] = useState(null);

            useEffect(() => {
                window.speechSynthesis.getVoices();
                setQuestions(generateQuestions());
            }, []);

            const currentQ = questions[qIndex];

            // TTS when question appears
            useEffect(() => {
                if (screen === 'playing' && currentQ && !roundWinner) {
                    setTimeout(() => {
                        speak(`Berapa ${currentQ.numA} ditambah ${currentQ.numB}?`);
                    }, 500);
                }
            }, [qIndex, screen, roundWinner]);

            const handleStart = () => {
                speak("Siap? Mulai!");
                setQuestions(generateQuestions(5));
                setQIndex(0);
                setScores({ left: 0, right: 0 });
                setRopePosition(50);
                setRoundWinner(null);
                setGameWinner(null);
                setScreen('playing');
            };

            const handleAnswer = (side, val) => {
                if (roundWinner) return; // Round already won

                if (val === currentQ.total) {
                    // Correct Answer!
                    setRoundWinner(side);
                    setScores(prev => ({ ...prev, [side]: prev[side] + 1 }));
                    
                    // Move Rope
                    const moveAmount = 10;
                    const newPos = side === 'left' ? ropePosition - moveAmount : ropePosition + moveAmount;
                    setRopePosition(newPos);

                    speak(side === 'left' ? "Tim Merah Benar!" : "Tim Biru Benar!");
                    confetti({
                        particleCount: 50,
                        spread: 60,
                        origin: { x: side === 'left' ? 0.25 : 0.75, y: 0.6 },
                        colors: side === 'left' ? ['#ef4444', '#fca5a5'] : ['#3b82f6', '#93c5fd']
                    });

                    setTimeout(() => {
                        if (qIndex < 4) {
                            setQIndex(prev => prev + 1);
                            setRoundWinner(null);
                        } else {
                            // Game Over
                            finishGame(newPos);
                        }
                    }, 2000);
                } else {
                    // Wrong Answer
                    speak("Salah!");
                    // Optional: Penalty or shake effect
                }
            };

            const finishGame = (finalPos) => {
                let winner = 'draw';
                if (finalPos < 50) winner = 'Tim Merah';
                if (finalPos > 50) winner = 'Tim Biru';
                
                setGameWinner(winner);
                setScreen('finish');
                speak(`Permainan Selesai. Pemenangnya adalah ${winner}!`);
                if (winner !== 'draw') {
                    confetti({ particleCount: 150, spread: 100, origin: { y: 0.6 } });
                }
            };

            // START SCREEN
            if (screen === 'start') {
                return (
                    <div className="h-full flex flex-col items-center justify-center p-4 text-center relative bg-blue-50">
                        <h1 className="text-5xl md:text-7xl font-black text-blue-600 mb-6 font-title drop-shadow-xl tracking-wide">
                            TARIK TAMBANG
                        </h1>
                        <h2 className="text-3xl md:text-4xl font-bold text-orange-500 mb-10 font-title">
                            Edisi Penjumlahan
                        </h2>
                        
                        <div className="flex items-center gap-8 mb-12 opacity-90">
                            <div className="bg-red-500 text-white p-4 rounded-2xl shadow-lg transform -rotate-6 flex flex-col items-center">
                                <img src="https://img.freepik.com/free-vector/cute-student-boy-with-red-shirt-cartoon-vector-icon-illustration-people-education-icon-isolated_138676-5366.jpg?w=200" alt="Tim Merah" className="w-24 h-24 rounded-full border-4 border-white/50 mb-2 object-cover" />
                                <p className="font-bold text-xl">Tim Merah</p>
                            </div>
                            <div className="text-5xl font-black text-gray-400 mx-4">VS</div>
                            <div className="bg-blue-500 text-white p-4 rounded-2xl shadow-lg transform rotate-6 flex flex-col items-center">
                                <img src="https://img.freepik.com/free-vector/cute-student-boy-wearing-blue-shirt-cartoon-vector-icon-illustration-people-education-isolated_138676-5367.jpg?w=200" alt="Tim Biru" className="w-24 h-24 rounded-full border-4 border-white/50 mb-2 object-cover" />
                                <p className="font-bold text-xl">Tim Biru</p>
                            </div>
                        </div>

                        <button onClick={handleStart} className="bg-green-500 hover:bg-green-600 text-white text-3xl font-black py-5 px-20 rounded-full shadow-[0_8px_0_rgb(21,128,61)] transform transition hover:scale-105 active:scale-95 active:shadow-none active:translate-y-2 flex items-center gap-4 border-4 border-green-400">
                            <i className="fa-solid fa-play"></i> MULAI
                        </button>
                    </div>
                );
            }

            // FINISH SCREEN
            if (screen === 'finish') {
                let WinnerImage = null;
                if (gameWinner === 'Tim Merah') {
                    WinnerImage = <img src="https://img.freepik.com/free-vector/cute-student-boy-with-red-shirt-cartoon-vector-icon-illustration-people-education-icon-isolated_138676-5366.jpg?w=200" alt="Tim Merah Menang" className="w-32 h-32 rounded-full border-8 border-red-500 shadow-xl mb-6" />;
                } else if (gameWinner === 'Tim Biru') {
                    WinnerImage = <img src="https://img.freepik.com/free-vector/cute-student-boy-wearing-blue-shirt-cartoon-vector-icon-illustration-people-education-isolated_138676-5367.jpg?w=200" alt="Tim Biru Menang" className="w-32 h-32 rounded-full border-8 border-blue-500 shadow-xl mb-6" />;
                } else {
                    WinnerImage = (
                        <div className="flex gap-4 mb-6">
                             <img src="https://img.freepik.com/free-vector/cute-student-boy-with-red-shirt-cartoon-vector-icon-illustration-people-education-icon-isolated_138676-5366.jpg?w=200" alt="Tim Merah" className="w-24 h-24 rounded-full border-4 border-red-500 shadow-lg opacity-80" />
                             <img src="https://img.freepik.com/free-vector/cute-student-boy-wearing-blue-shirt-cartoon-vector-icon-illustration-people-education-isolated_138676-5367.jpg?w=200" alt="Tim Biru" className="w-24 h-24 rounded-full border-4 border-blue-500 shadow-lg opacity-80" />
                        </div>
                    );
                }

                return (
                    <div className="h-full flex flex-col items-center justify-center p-4 text-center bg-yellow-100">
                        <div className="text-9xl mb-4 animate-bounce">üèÜ</div>
                        <h1 className="text-6xl font-black text-orange-600 mb-4 font-title">SELESAI!</h1>
                        
                        {WinnerImage}

                        <p className="text-4xl text-gray-700 mb-4 font-bold">
                            {gameWinner === 'draw' ? "SERI!" : `Pemenang: ${gameWinner}`}
                        </p>
                        <div className="flex gap-8 mb-10 text-2xl font-bold text-gray-600">
                            <span>üî¥ {scores.left}</span>
                            <span>üîµ {scores.right}</span>
                        </div>
                        <button onClick={handleStart} className="bg-purple-500 hover:bg-purple-600 text-white text-xl font-bold py-4 px-12 rounded-full shadow-[0_6px_0_rgb(190,24,93)] transform transition hover:scale-105 active:scale-95 active:shadow-none active:translate-y-2 flex items-center gap-3 border-4 border-purple-400">
                            <i className="fa-solid fa-rotate-right"></i> Main Lagi
                        </button>
                        <div className="mt-12">
                            <p className="text-gray-500 text-sm font-bold">
                                Dibuat oleh <span className="text-purple-600">Abdul Salim Owner folderosn.com</span>
                            </p>
                            <a href="https://pakabdulsalim.blogspot.com/" target="_blank" className="text-blue-500 text-sm font-bold hover:underline">Kunjungi: https://pakabdulsalim.blogspot.com</a>
                        </div>
                    </div>
                );
            }

            // PLAYING SCREEN
            return (
                <div className="flex flex-col h-full bg-slate-50 overflow-hidden relative">
                    
                    {/* Top Bar: The Question (Shared) */}
                    <div className="absolute top-0 left-0 w-full h-1/3 bg-white z-10 shadow-xl flex flex-col items-center justify-center border-b-8 border-slate-200">
                        <div className="text-gray-400 font-bold mb-2 uppercase tracking-widest text-sm">Soal {qIndex + 1} / 5</div>
                        
                        <div className="flex items-center gap-4 md:gap-8">
                            {/* Obj A */}
                            <div className="flex flex-col items-center">
                                <ObjectBox type={currentQ.type} color={currentQ.color} count={currentQ.numA} />
                                <span className="text-4xl font-black text-gray-700 mt-2">{currentQ.numA}</span>
                            </div>

                            <i className="fa-solid fa-plus text-4xl md:text-6xl text-gray-300"></i>

                            {/* Obj B */}
                            <div className="flex flex-col items-center">
                                <ObjectBox type={currentQ.type} color={currentQ.color} count={currentQ.numB} />
                                <span className="text-4xl font-black text-gray-700 mt-2">{currentQ.numB}</span>
                            </div>
                        </div>
                    </div>

                    {/* Middle: The Rope (Progress Bar) */}
                    <div className="absolute top-1/3 left-0 w-full h-16 z-20 flex items-center pointer-events-none">
                        <div className="w-full h-4 bg-gray-300 relative rounded-full mx-4 shadow-inner">
                            {/* Center Marker */}
                            <div className="absolute left-1/2 top-0 h-full w-1 bg-gray-400 transform -translate-x-1/2"></div>
                            
                            {/* The Knot */}
                            <div 
                                className="absolute top-1/2 w-12 h-12 bg-orange-500 rounded-full border-4 border-white shadow-lg transform -translate-y-1/2 -translate-x-1/2 transition-all duration-500 ease-out flex items-center justify-center"
                                style={{ left: `${ropePosition}%` }}
                            >
                                <span className="text-white font-bold text-xs">VS</span>
                            </div>
                        </div>
                    </div>

                    {/* Bottom: Player Zones */}
                    <div className="flex-grow mt-[33vh] flex w-full h-2/3">
                        
                        {/* Left Player (Red) */}
                        <div className="flex-1 bg-red-50 border-r-2 border-red-100 flex flex-col">
                            <PlayerPanel 
                                side="left" 
                                score={scores.left} 
                                options={currentQ.options} 
                                onAnswer={handleAnswer}
                                disabled={!!roundWinner}
                                isWinner={roundWinner === 'left'}
                            />
                        </div>

                        {/* Right Player (Blue) */}
                        <div className="flex-1 bg-blue-50 border-l-2 border-blue-100 flex flex-col">
                            <PlayerPanel 
                                side="right" 
                                score={scores.right} 
                                options={currentQ.options} 
                                onAnswer={handleAnswer}
                                disabled={!!roundWinner}
                                isWinner={roundWinner === 'right'}
                            />
                        </div>

                    </div>

                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
