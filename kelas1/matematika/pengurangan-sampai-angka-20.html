<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Tarik Tambang Pengurangan - Kelas 1 SD</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    
    <!-- Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- Font & Icons -->
    <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;600;700&family=Varela+Round&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Confetti -->
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

    <style>
        body {
            font-family: 'Varela Round', sans-serif;
            background-color: #fffbeb; /* Light yellow tint for variety */
            background-image: radial-gradient(#fcd34d 2px, transparent 2px);
            background-size: 24px 24px;
            overflow: hidden;
            touch-action: none;
            user-select: none;
        }
        
        .font-title { font-family: 'Fredoka', sans-serif; }

        /* Rope Texture */
        .rope {
            background: repeating-linear-gradient(
                45deg,
                #d97706,
                #d97706 10px,
                #b45309 10px,
                #b45309 20px
            );
            box-shadow: 0 4px 6px rgba(0,0,0,0.3);
        }

        /* Button Styles */
        .answer-btn {
            transition: all 0.1s;
            border-bottom-width: 6px;
        }
        .answer-btn:active {
            transform: translateY(4px);
            border-bottom-width: 2px;
        }

        /* Animations */
        @keyframes pop {
            0% { transform: scale(0.5); opacity: 0; }
            60% { transform: scale(1.1); opacity: 1; }
            100% { transform: scale(1); }
        }
        .animate-pop { animation: pop 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards; }

        @keyframes pull-left {
            0% { transform: translateX(0); }
            50% { transform: translateX(-30px); }
            100% { transform: translateX(-10px); }
        }
        @keyframes pull-right {
            0% { transform: translateX(0); }
            50% { transform: translateX(30px); }
            100% { transform: translateX(10px); }
        }
        
        .pull-anim-left { animation: pull-left 0.5s ease-in-out; }
        .pull-anim-right { animation: pull-right 0.5s ease-in-out; }

        /* Crossed out effect for subtraction visual */
        .crossed-out {
            position: relative;
            opacity: 0.5;
        }
        .crossed-out::after {
            content: '‚úñ';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: red;
            font-size: 2rem;
            font-weight: bold;
            text-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

    </style>
</head>
<body class="flex flex-col h-screen">
    <div id="root" class="flex-grow h-full"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // --- 1. ASSETS: SVG ICONS ---
        const Icons = {
            Apple: ({ color }) => (
                <svg viewBox="0 0 100 100" className="w-full h-full drop-shadow-sm">
                    <path d="M50 20 Q 65 5 80 20 Q 95 35 85 65 Q 75 95 50 90 Q 25 95 15 65 Q 5 35 20 20 Q 35 5 50 20" fill={color} />
                    <path d="M50 20 Q 50 5 55 10" stroke="#4a7c59" strokeWidth="4" fill="none" />
                </svg>
            ),
            Car: ({ color }) => (
                <svg viewBox="0 0 100 60" className="w-full h-full drop-shadow-sm">
                    <path d="M10 35 L20 15 L75 15 L85 35 L90 35 Q 95 35 95 45 L95 50 L5 50 L5 45 Q 5 35 10 35 Z" fill={color} />
                    <circle cx="25" cy="50" r="8" fill="#333" />
                    <circle cx="75" cy="50" r="8" fill="#333" />
                </svg>
            ),
            Star: ({ color }) => (
                <svg viewBox="0 0 100 100" className="w-full h-full drop-shadow-sm">
                    <polygon points="50,5 61,35 95,35 68,55 79,90 50,70 21,90 32,55 5,35 39,35" fill={color} stroke="rgba(0,0,0,0.1)" strokeWidth="2" />
                </svg>
            ),
            Ball: ({ color }) => (
                <svg viewBox="0 0 100 100" className="w-full h-full drop-shadow-sm">
                    <circle cx="50" cy="50" r="45" fill={color} />
                    <path d="M5 50 Q 50 20 95 50" fill="none" stroke="rgba(255,255,255,0.5)" strokeWidth="4" />
                </svg>
            ),
            Cookie: ({ color }) => (
                <svg viewBox="0 0 100 100" className="w-full h-full drop-shadow-sm">
                    <circle cx="50" cy="50" r="40" fill={color} />
                    <circle cx="30" cy="40" r="5" fill="rgba(0,0,0,0.2)" />
                    <circle cx="70" cy="30" r="5" fill="rgba(0,0,0,0.2)" />
                    <circle cx="50" cy="70" r="5" fill="rgba(0,0,0,0.2)" />
                </svg>
            ),
            Flower: ({ color }) => (
                <svg viewBox="0 0 100 100" className="w-full h-full drop-shadow-sm">
                    <circle cx="30" cy="30" r="15" fill={color} />
                    <circle cx="70" cy="30" r="15" fill={color} />
                    <circle cx="30" cy="70" r="15" fill={color} />
                    <circle cx="70" cy="70" r="15" fill={color} />
                    <circle cx="50" cy="50" r="20" fill="#facc15" />
                </svg>
            )
        };

        // --- 2. GAME LOGIC ---
        const OBJECT_TYPES = ['Apple', 'Car', 'Star', 'Ball', 'Cookie', 'Flower'];
        const COLORS = ["#ef4444", "#3b82f6", "#22c55e", "#eab308", "#a855f7", "#f97316", "#ec4899"];

        const getRandom = (arr) => arr[Math.floor(Math.random() * arr.length)];
        const getRandomInt = (min, max) => Math.floor(Math.random() * (max - min + 1)) + min;

        const generateQuestions = (count = 5) => {
            let quests = [];
            for (let i = 0; i < count; i++) {
                const type = getRandom(OBJECT_TYPES);
                const color = getRandom(COLORS);
                
                // Generate numbers for Subtraction
                // Start Number (Total) max 20, min 2
                const numA = getRandomInt(2, 20);
                // Subtract amount (must be <= numA)
                const numB = getRandomInt(1, numA);
                
                const result = numA - numB;

                // Generate Options (1 Correct, 2 Distractors)
                const opts = new Set([result]);
                while(opts.size < 3) {
                    // Distractors close to result but not negative
                    let distractor = getRandomInt(Math.max(0, result - 5), Math.min(20, result + 5));
                    if (distractor !== result) opts.add(distractor);
                }

                quests.push({
                    id: i + 1,
                    type,
                    color,
                    numA, // Total items displayed
                    numB, // Items to cross out
                    result,
                    options: Array.from(opts).sort((a, b) => a - b)
                });
            }
            return quests;
        };

        const speak = (text) => {
            if ('speechSynthesis' in window) {
                window.speechSynthesis.cancel();
                const utterance = new SpeechSynthesisUtterance(text);
                utterance.lang = 'id-ID';
                utterance.rate = 0.9;
                window.speechSynthesis.speak(utterance);
            }
        };

        // --- 3. COMPONENTS ---

        const ObjectBox = ({ type, color, count, crossedCount }) => {
            const Icon = Icons[type];
            return (
                <div className="bg-white/80 p-2 rounded-2xl border-4 border-orange-200 shadow-inner flex flex-wrap justify-center content-center gap-1 w-full min-h-[120px] md:min-h-[160px] overflow-hidden">
                    {[...Array(count)].map((_, i) => {
                        // Cross out the LAST 'crossedCount' items
                        const isCrossed = i >= (count - crossedCount);
                        return (
                            <div 
                                key={i} 
                                className={`w-8 h-8 md:w-10 md:h-10 animate-pop transition-all ${isCrossed ? 'crossed-out grayscale scale-90' : ''}`} 
                                style={{animationDelay: `${i * 0.05}s`}}
                            >
                                <Icon color={color} />
                            </div>
                        );
                    })}
                </div>
            );
        };

        const PlayerPanel = ({ side, score, options, onAnswer, disabled, isWinner }) => {
            // Left = Green (Hijau) - Request says "Left Green"? No, prompt says "Warna Kiri Hijau, Kanan Kuning"
            const isLeft = side === 'left';
            
            // Colors based on prompt: Left=Green, Right=Yellow
            const bgClass = isLeft ? 'bg-green-100 border-green-300' : 'bg-yellow-100 border-yellow-300';
            const textClass = isLeft ? 'text-green-700' : 'text-yellow-700';
            const btnClass = isLeft ? 'bg-green-500 border-green-700 hover:bg-green-600' : 'bg-yellow-500 border-yellow-700 hover:bg-yellow-600 text-white'; // Yellow text usually needs to be dark or button text white

            return (
                <div className={`flex-1 flex flex-col p-2 md:p-4 border-r-4 border-white/50 relative ${isLeft ? 'items-start' : 'items-end'}`}>
                    {/* Score Badge */}
                    <div className={`absolute top-4 ${isLeft ? 'left-4' : 'right-4'} text-2xl font-black ${textClass} bg-white px-4 py-2 rounded-full shadow-lg border-2 ${isLeft ? 'border-green-200' : 'border-yellow-200'}`}>
                        {score} <i className="fa-solid fa-star text-orange-400 ml-1"></i>
                    </div>

                    {/* Team Label */}
                    <h2 className={`mt-16 md:mt-12 text-2xl md:text-3xl font-black ${textClass} w-full text-center uppercase tracking-wider drop-shadow-sm bg-white/50 rounded-lg py-1`}>
                        TIM {isLeft ? 'HIJAU' : 'KUNING'}
                    </h2>

                    {/* Options Grid */}
                    <div className="flex-grow flex flex-col justify-center w-full max-w-md mx-auto gap-4 mt-4">
                        {options.map((opt, idx) => (
                            <button 
                                key={idx}
                                onClick={() => onAnswer(side, opt)}
                                disabled={disabled}
                                className={`answer-btn w-full py-4 md:py-6 rounded-2xl text-3xl md:text-5xl font-black text-white shadow-lg border-b-[6px] transform transition active:scale-95 disabled:opacity-50 disabled:cursor-not-allowed ${btnClass}`}
                            >
                                {opt}
                            </button>
                        ))}
                    </div>
                    
                    {isWinner && (
                        <div className="absolute inset-0 bg-white/80 z-50 flex items-center justify-center animate-pop rounded-xl">
                            <div className="text-center">
                                <div className="text-6xl mb-2">üèÜ</div>
                                <div className={`text-4xl font-black ${textClass}`}>MENANG!</div>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        // --- 4. MAIN APP ---
        const App = () => {
            const [screen, setScreen] = useState('start');
            const [questions, setQuestions] = useState([]);
            const [qIndex, setQIndex] = useState(0);
            
            // Game State
            const [ropePosition, setRopePosition] = useState(50); // 0 to 100
            const [scores, setScores] = useState({ left: 0, right: 0 });
            const [roundWinner, setRoundWinner] = useState(null);
            const [gameWinner, setGameWinner] = useState(null);

            useEffect(() => {
                window.speechSynthesis.getVoices();
                setQuestions(generateQuestions());
            }, []);

            const currentQ = questions[qIndex];

            // TTS when question appears
            useEffect(() => {
                if (screen === 'playing' && currentQ && !roundWinner) {
                    setTimeout(() => {
                        speak(`Berapa ${currentQ.numA} dikurang ${currentQ.numB}?`);
                    }, 500);
                }
            }, [qIndex, screen, roundWinner]);

            const handleStart = () => {
                speak("Siap? Mulai!");
                setQuestions(generateQuestions(5));
                setQIndex(0);
                setScores({ left: 0, right: 0 });
                setRopePosition(50);
                setRoundWinner(null);
                setGameWinner(null);
                setScreen('playing');
            };

            const handleAnswer = (side, val) => {
                if (roundWinner) return; 

                if (val === currentQ.result) {
                    // Correct
                    setRoundWinner(side);
                    setScores(prev => ({ ...prev, [side]: prev[side] + 1 }));
                    
                    // Move Rope
                    const moveAmount = 10;
                    const newPos = side === 'left' ? ropePosition - moveAmount : ropePosition + moveAmount;
                    setRopePosition(newPos);

                    speak(side === 'left' ? "Tim Hijau Benar!" : "Tim Kuning Benar!");
                    confetti({
                        particleCount: 50,
                        spread: 60,
                        origin: { x: side === 'left' ? 0.25 : 0.75, y: 0.6 },
                        colors: side === 'left' ? ['#22c55e', '#86efac'] : ['#eab308', '#fde047']
                    });

                    setTimeout(() => {
                        if (qIndex < 4) {
                            setQIndex(prev => prev + 1);
                            setRoundWinner(null);
                        } else {
                            finishGame(newPos);
                        }
                    }, 2000);
                } else {
                    speak("Salah!");
                }
            };

            const finishGame = (finalPos) => {
                let winner = 'draw';
                if (finalPos < 50) winner = 'Tim Hijau';
                if (finalPos > 50) winner = 'Tim Kuning';
                
                setGameWinner(winner);
                setScreen('finish');
                speak(`Permainan Selesai. Pemenangnya adalah ${winner}!`);
                if (winner !== 'draw') {
                    confetti({ particleCount: 150, spread: 100, origin: { y: 0.6 } });
                }
            };

            // START SCREEN
            if (screen === 'start') {
                return (
                    <div className="h-full flex flex-col items-center justify-center p-4 text-center relative bg-orange-50">
                        <h1 className="text-5xl md:text-7xl font-black text-orange-600 mb-6 font-title drop-shadow-xl tracking-wide">
                            TARIK TAMBANG
                        </h1>
                        <h2 className="text-3xl md:text-4xl font-bold text-red-500 mb-10 font-title">
                            Edisi Pengurangan
                        </h2>
                        
                        <div className="flex items-center gap-8 mb-12 opacity-90">
                            <div className="bg-green-500 text-white p-6 rounded-2xl shadow-lg transform -rotate-6 w-40">
                                <i className="fa-solid fa-user text-4xl"></i>
                                <p className="font-bold mt-2">Tim Hijau</p>
                            </div>
                            <div className="text-4xl font-black text-gray-400">VS</div>
                            <div className="bg-yellow-500 text-white p-6 rounded-2xl shadow-lg transform rotate-6 w-40">
                                <i className="fa-solid fa-user text-4xl"></i>
                                <p className="font-bold mt-2">Tim Kuning</p>
                            </div>
                        </div>

                        <button onClick={handleStart} className="bg-blue-500 hover:bg-blue-600 text-white text-3xl font-black py-5 px-20 rounded-full shadow-[0_8px_0_rgb(30,64,175)] transform transition hover:scale-105 active:scale-95 active:shadow-none active:translate-y-2 flex items-center gap-4 border-4 border-blue-400">
                            <i className="fa-solid fa-play"></i> MULAI
                        </button>
                    </div>
                );
            }

            // FINISH SCREEN
            if (screen === 'finish') {
                let WinnerImage = null;
                // Simple placeholder icons for winners
                if (gameWinner === 'Tim Hijau') {
                    WinnerImage = <div className="text-8xl mb-4 animate-bounce">üíö</div>;
                } else if (gameWinner === 'Tim Kuning') {
                    WinnerImage = <div className="text-8xl mb-4 animate-bounce">üíõ</div>;
                }

                return (
                    <div className="h-full flex flex-col items-center justify-center p-4 text-center bg-blue-50">
                        {WinnerImage || <div className="text-8xl mb-4">ü§ù</div>}
                        
                        <h1 className="text-6xl font-black text-blue-600 mb-4 font-title">SELESAI!</h1>
                        <p className="text-4xl text-gray-700 mb-4 font-bold">
                            {gameWinner === 'draw' ? "SERI!" : `Pemenang: ${gameWinner}`}
                        </p>
                        <div className="flex gap-8 mb-10 text-2xl font-bold text-gray-600">
                            <span className="text-green-600">üíö {scores.left}</span>
                            <span className="text-yellow-600">üíõ {scores.right}</span>
                        </div>
                        <button onClick={handleStart} className="bg-orange-500 hover:bg-orange-600 text-white text-xl font-bold py-4 px-12 rounded-full shadow-[0_6px_0_rgb(194,65,12)] transform transition hover:scale-105 active:scale-95 active:shadow-none active:translate-y-2 flex items-center gap-3 border-4 border-orange-400">
                            <i className="fa-solid fa-rotate-right"></i> Main Lagi
                        </button>
                        <div className="mt-12">
                            <p className="text-gray-500 text-sm font-bold">
                                Dibuat oleh <span className="text-blue-600">Abdul Salim Owner folderosn.com</span>
                            </p>
                            <a href="https://pakabdulsalim.blogspot.com/" target="_blank" className="text-blue-500 text-sm font-bold hover:underline">Kunjungi: https://pakabdulsalim.blogspot.com</a>
                        </div>
                    </div>
                );
            }

            // PLAYING SCREEN
            const isGreenTurn = true; // Both active simultaneously in this mode

            return (
                <div className="flex flex-col h-full bg-gray-50 overflow-hidden relative">
                    
                    {/* Top Bar: The Question */}
                    <div className="absolute top-0 left-0 w-full h-1/3 bg-white z-10 shadow-xl flex flex-col items-center justify-center border-b-8 border-gray-200">
                        <div className="text-gray-400 font-bold mb-1 uppercase tracking-widest text-sm">Soal {qIndex + 1} / 5</div>
                        
                        <div className="flex flex-col items-center w-full max-w-2xl px-4">
                            {/* Visuals */}
                            <ObjectBox type={currentQ.type} color={currentQ.color} count={currentQ.numA} crossedCount={currentQ.numB} />
                            
                            {/* Equation */}
                            <div className="flex items-center gap-4 mt-2">
                                <span className="text-5xl font-black text-gray-700">{currentQ.numA}</span>
                                <i className="fa-solid fa-minus text-4xl text-red-400"></i>
                                <span className="text-5xl font-black text-gray-700">{currentQ.numB}</span>
                                <i className="fa-solid fa-equals text-4xl text-gray-400"></i>
                                <span className="text-5xl font-black text-blue-500">?</span>
                            </div>
                        </div>
                    </div>

                    {/* Middle: The Rope */}
                    <div className="absolute top-1/3 left-0 w-full h-16 z-20 flex items-center pointer-events-none">
                        <div className="w-full h-6 bg-orange-800 relative rounded-full mx-4 shadow-inner rope border-2 border-orange-900">
                            {/* Center Marker */}
                            <div className="absolute left-1/2 top-0 h-full w-2 bg-white/50 transform -translate-x-1/2"></div>
                            
                            {/* The Knot */}
                            <div 
                                className="absolute top-1/2 w-14 h-14 bg-red-600 rounded-full border-4 border-white shadow-xl transform -translate-y-1/2 -translate-x-1/2 transition-all duration-500 ease-out flex items-center justify-center"
                                style={{ left: `${ropePosition}%` }}
                            >
                                <span className="text-white font-black text-xs">VS</span>
                            </div>
                        </div>
                    </div>

                    {/* Bottom: Player Zones (Left Green, Right Yellow) */}
                    <div className="flex-grow mt-[33vh] flex w-full h-2/3">
                        
                        {/* Left Player (Green) */}
                        <div className="flex-1 bg-green-50 border-r-4 border-green-200 flex flex-col">
                            <PlayerPanel 
                                side="left" 
                                score={scores.left} 
                                options={currentQ.options} 
                                onAnswer={handleAnswer}
                                disabled={!!roundWinner}
                                isWinner={roundWinner === 'left'}
                            />
                        </div>

                        {/* Right Player (Yellow) */}
                        <div className="flex-1 bg-yellow-50 border-l-4 border-yellow-200 flex flex-col">
                            <PlayerPanel 
                                side="right" 
                                score={scores.right} 
                                options={currentQ.options} 
                                onAnswer={handleAnswer}
                                disabled={!!roundWinner}
                                isWinner={roundWinner === 'right'}
                            />
                        </div>

                    </div>

                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
