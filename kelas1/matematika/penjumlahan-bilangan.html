<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tarik Tambang Matematika</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    
    <!-- Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- Font & Icons -->
    <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Confetti -->
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

    <style>
        body {
            font-family: 'Fredoka', sans-serif;
            background-color: #e0f2fe;
            background-image: radial-gradient(#7dd3fc 2px, transparent 2px);
            background-size: 30px 30px;
            overflow-x: hidden;
        }
        
        .rope-texture {
            background: repeating-linear-gradient(
                45deg,
                #d97706,
                #d97706 10px,
                #b45309 10px,
                #b45309 20px
            );
        }

        @keyframes pull-left {
            0% { transform: translateX(0); }
            50% { transform: translateX(-20px); }
            100% { transform: translateX(0); }
        }
        @keyframes pull-right {
            0% { transform: translateX(0); }
            50% { transform: translateX(20px); }
            100% { transform: translateX(0); }
        }
        
        .animate-pull-left { animation: pull-left 0.5s ease-in-out; }
        .animate-pull-right { animation: pull-right 0.5s ease-in-out; }

        .pop-in { animation: pop 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
        @keyframes pop { 0% { transform: scale(0); } 100% { transform: scale(1); } }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // --- HELPER: TEXT TO SPEECH ---
        const speak = (text) => {
            if ('speechSynthesis' in window) {
                window.speechSynthesis.cancel(); // Stop previous speech
                const utterance = new SpeechSynthesisUtterance(text);
                utterance.lang = 'id-ID'; // Bahasa Indonesia
                utterance.rate = 0.9; // Sedikit lambat untuk anak-anak
                window.speechSynthesis.speak(utterance);
            }
        };

        // --- ASSETS: ICON COMPONENTS ---
        const Icons = {
            Car: ({ color }) => (
                <svg viewBox="0 0 100 60" className="w-10 h-10 md:w-14 md:h-14 drop-shadow-sm inline-block m-1 transition-transform hover:scale-110">
                    <path d="M10 35 L20 15 L75 15 L85 35 L90 35 Q 95 35 95 45 L95 50 L5 50 L5 45 Q 5 35 10 35 Z" fill={color} />
                    <circle cx="25" cy="50" r="8" fill="#333" />
                    <circle cx="75" cy="50" r="8" fill="#333" />
                    <circle cx="25" cy="50" r="3" fill="#999" />
                    <circle cx="75" cy="50" r="3" fill="#999" />
                    <path d="M25 20 L45 20 L45 35 L15 35 Z" fill="rgba(255,255,255,0.4)" />
                    <path d="M50 20 L70 20 L80 35 L50 35 Z" fill="rgba(255,255,255,0.4)" />
                </svg>
            ),
            Apple: ({ color }) => (
                <svg viewBox="0 0 100 100" className="w-10 h-10 md:w-14 md:h-14 drop-shadow-sm inline-block m-1">
                    <path d="M50 20 Q 65 5 80 20 Q 95 35 85 65 Q 75 95 50 90 Q 25 95 15 65 Q 5 35 20 20 Q 35 5 50 20" fill={color} />
                    <path d="M50 20 Q 50 5 55 10" stroke="#4a7c59" strokeWidth="4" fill="none" />
                    <path d="M50 20 Q 30 10 40 30" fill="#84cc16" />
                </svg>
            ),
            Star: ({ color }) => (
                <svg viewBox="0 0 100 100" className="w-10 h-10 md:w-14 md:h-14 drop-shadow-sm inline-block m-1">
                    <polygon points="50,5 61,35 95,35 68,55 79,90 50,70 21,90 32,55 5,35 39,35" fill={color} stroke="#eab308" strokeWidth="2" />
                </svg>
            ),
            Ball: ({ color }) => (
                <svg viewBox="0 0 100 100" className="w-10 h-10 md:w-14 md:h-14 drop-shadow-sm inline-block m-1">
                    <circle cx="50" cy="50" r="45" fill={color} />
                    <path d="M5 50 Q 50 20 95 50" fill="none" stroke="rgba(255,255,255,0.5)" strokeWidth="4" />
                    <path d="M5 50 Q 50 80 95 50" fill="none" stroke="rgba(255,255,255,0.5)" strokeWidth="4" />
                </svg>
            ),
            Flower: ({ color }) => (
                <svg viewBox="0 0 100 100" className="w-10 h-10 md:w-14 md:h-14 drop-shadow-sm inline-block m-1">
                    <circle cx="30" cy="30" r="15" fill={color} />
                    <circle cx="70" cy="30" r="15" fill={color} />
                    <circle cx="30" cy="70" r="15" fill={color} />
                    <circle cx="70" cy="70" r="15" fill={color} />
                    <circle cx="50" cy="50" r="20" fill="#facc15" />
                </svg>
            )
        };

        // --- DATA: BANK SOAL (15 SOAL) ---
        const QUESTIONS = [
            { id: 1, type: 'Car', colorA: '#facc15', countA: 4, nameA: 'kuning', colorB: '#ef4444', countB: 5, nameB: 'merah' }, // Sesuai gambar upload
            { id: 2, type: 'Apple', colorA: '#ef4444', countA: 3, nameA: 'merah', colorB: '#84cc16', countB: 2, nameB: 'hijau' },
            { id: 3, type: 'Star', colorA: '#3b82f6', countA: 2, nameA: 'biru', colorB: '#eab308', countB: 4, nameB: 'kuning' },
            { id: 4, type: 'Ball', colorA: '#f97316', countA: 5, nameA: 'oranye', colorB: '#a855f7', countB: 1, nameB: 'ungu' },
            { id: 5, type: 'Flower', colorA: '#ec4899', countA: 4, nameA: 'merah muda', colorB: '#f43f5e', countB: 4, nameB: 'merah' },
            { id: 6, type: 'Car', colorA: '#3b82f6', countA: 2, nameA: 'biru', colorB: '#22c55e', countB: 3, nameB: 'hijau' },
            { id: 7, type: 'Apple', colorA: '#ef4444', countA: 5, nameA: 'merah', colorB: '#ef4444', countB: 5, nameB: 'merah' }, // 10 total
            { id: 8, type: 'Star', colorA: '#a855f7', countA: 6, nameA: 'ungu', colorB: '#eab308', countB: 3, nameB: 'kuning' },
            { id: 9, type: 'Ball', colorA: '#3b82f6', countA: 1, nameA: 'biru', colorB: '#ef4444', countB: 7, nameB: 'merah' },
            { id: 10, type: 'Flower', colorA: '#f97316', countA: 2, nameA: 'oranye', colorB: '#a855f7', countB: 2, nameB: 'ungu' },
            { id: 11, type: 'Car', colorA: '#22c55e', countA: 5, nameA: 'hijau', colorB: '#facc15', countB: 1, nameB: 'kuning' },
            { id: 12, type: 'Apple', colorA: '#84cc16', countA: 3, nameA: 'hijau', colorB: '#ef4444', countB: 4, nameB: 'merah' },
            { id: 13, type: 'Star', colorA: '#3b82f6', countA: 2, nameA: 'biru', colorB: '#ef4444', countB: 2, nameB: 'merah' },
            { id: 14, type: 'Ball', colorA: '#14b8a6', countA: 3, nameA: 'teal', colorB: '#facc15', countB: 5, nameB: 'kuning' },
            { id: 15, type: 'Flower', colorA: '#ec4899', countA: 7, nameA: 'pink', colorB: '#3b82f6', countB: 2, nameB: 'biru' }
        ];

        const getObjectIndonesianName = (type) => {
            switch(type) {
                case 'Car': return 'mobil';
                case 'Apple': return 'apel';
                case 'Star': return 'bintang';
                case 'Ball': return 'bola';
                case 'Flower': return 'bunga';
                default: return 'benda';
            }
        };

        const App = () => {
            const [screen, setScreen] = useState('start'); // start, game, win
            const [ropePos, setRopePos] = useState(0); // -5 (Left Win) to 5 (Right Win)
            const [turn, setTurn] = useState('left'); // left or right
            const [qIndex, setQIndex] = useState(0);
            const [shuffledQuestions, setShuffledQuestions] = useState([]);
            const [feedback, setFeedback] = useState(null); // correct, wrong
            const [winner, setWinner] = useState(null);

            // Init Questions
            useEffect(() => {
                setShuffledQuestions([...QUESTIONS].sort(() => Math.random() - 0.5));
            }, []);

            const currentQ = shuffledQuestions[qIndex] || QUESTIONS[0];
            const total = currentQ.countA + currentQ.countB;

            // -- Effect: Read Question when Game Screen Active & Question Changes --
            useEffect(() => {
                if (screen === 'game') {
                    readQuestion();
                }
            }, [qIndex, screen]);

            const readQuestion = () => {
                const objName = getObjectIndonesianName(currentQ.type);
                const text = `Ada ${currentQ.countA} ${objName} berwarna ${currentQ.nameA}, dan ${currentQ.countB} ${objName} berwarna ${currentQ.nameB}. Berapa jumlah semuanya?`;
                speak(text);
            };

            const handleStart = () => {
                setScreen('game');
                setRopePos(0);
                setTurn('left');
                setQIndex(0);
                setFeedback(null);
                speak("Ayo mulai bermain!");
            };

            const handleAnswer = (num) => {
                if (num === total) {
                    // Correct
                    setFeedback('correct');
                    speak("Yey! Jawabanmu benar!");
                    
                    const newPos = turn === 'left' ? ropePos - 1 : ropePos + 1;
                    
                    // Confetti effect
                    confetti({
                        particleCount: 50,
                        spread: 60,
                        origin: { x: turn === 'left' ? 0.2 : 0.8, y: 0.7 }
                    });

                    // Check Win
                    if (newPos <= -4) {
                        setWinner('TIM MERAH');
                        setTimeout(() => { setScreen('win'); speak("Selamat! Tim Merah Menang!"); }, 1500);
                    } else if (newPos >= 4) {
                        setWinner('TIM BIRU');
                        setTimeout(() => { setScreen('win'); speak("Selamat! Tim Biru Menang!"); }, 1500);
                    } else {
                        // Next Turn
                        setTimeout(() => {
                            setRopePos(newPos);
                            setTurn(turn === 'left' ? 'right' : 'left');
                            setQIndex((prev) => (prev + 1) % shuffledQuestions.length);
                            setFeedback(null);
                        }, 1500); // Delay sedikit agar suara "Benar" selesai
                    }
                } else {
                    // Wrong
                    setFeedback('wrong');
                    speak("Ups, masih salah. Coba hitung lagi ya.");
                    setTimeout(() => setFeedback(null), 1500);
                }
            };

            // --- SCREEN: START ---
            if (screen === 'start') {
                return (
                    <div className="min-h-screen flex flex-col items-center justify-center p-4 text-center relative overflow-hidden">
                        <h1 className="text-5xl md:text-6xl font-bold text-blue-600 mb-4 drop-shadow-lg tracking-wide uppercase">
                            Tarik Tambang <br/><span className="text-orange-500">Matematika</span>
                        </h1>
                        <p className="text-xl text-gray-600 mb-8 font-medium">Siapa yang paling jago berhitung?</p>
                        
                        <div className="flex gap-8 mb-10">
                            <div className="bg-red-100 p-6 rounded-2xl border-4 border-red-400 shadow-xl transform rotate-[-5deg]">
                                <div className="text-4xl mb-2">üî¥</div>
                                <div className="font-bold text-red-600 text-xl">TIM MERAH</div>
                            </div>
                            <div className="text-4xl font-bold text-gray-400 flex items-center">VS</div>
                            <div className="bg-blue-100 p-6 rounded-2xl border-4 border-blue-400 shadow-xl transform rotate-[5deg]">
                                <div className="text-4xl mb-2">üîµ</div>
                                <div className="font-bold text-blue-600 text-xl">TIM BIRU</div>
                            </div>
                        </div>

                        <button onClick={handleStart} className="bg-green-500 hover:bg-green-600 text-white text-2xl font-bold py-4 px-12 rounded-full shadow-2xl transform transition hover:scale-105 active:scale-95 border-b-8 border-green-700">
                            MULAI MAIN!
                        </button>
                    </div>
                );
            }

            // --- SCREEN: WIN ---
            if (screen === 'win') {
                return (
                    <div className="min-h-screen flex flex-col items-center justify-center p-4 text-center bg-yellow-50">
                        <div className="text-9xl mb-6 animate-bounce">üèÜ</div>
                        <h1 className="text-5xl font-bold text-orange-600 mb-2">PEMENANGNYA...</h1>
                        <h2 className={`text-6xl font-black mb-8 ${winner === 'TIM MERAH' ? 'text-red-600' : 'text-blue-600'}`}>
                            {winner}!
                        </h2>
                        <button onClick={handleStart} className="bg-blue-500 text-white font-bold py-3 px-8 rounded-full shadow-lg text-xl">
                            Main Lagi
                        </button>
                    </div>
                );
            }

            // --- SCREEN: GAME ---
            const IconComp = Icons[currentQ.type];
            const isRedTurn = turn === 'left';
            const objName = getObjectIndonesianName(currentQ.type);

            return (
                <div className="min-h-screen flex flex-col bg-white">
                    
                    {/* HEADER: ARENA TARIK TAMBANG */}
                    <div className="bg-green-100 p-4 pb-10 relative overflow-hidden border-b-4 border-green-300 shadow-md">
                        {/* Ground Line */}
                        <div className="absolute bottom-4 left-0 right-0 h-1 bg-green-800 opacity-20"></div>
                        
                        {/* Rope System */}
                        <div className="relative flex items-center justify-center mt-8 h-20">
                            
                            {/* Characters & Rope Group */}
                            <div 
                                className="flex items-center transition-transform duration-700 ease-in-out relative"
                                style={{ transform: `translateX(${ropePos * 10}%)` }}
                            >
                                {/* Left Team (Red) */}
                                <div className="flex flex-col items-center relative z-10">
                                    <div className={`text-5xl transform scale-x-[-1] ${isRedTurn ? 'animate-bounce' : ''}`}>üòà</div>
                                    <div className="font-bold text-red-600 bg-white px-2 rounded shadow mt-1 text-xs">MERAH</div>
                                </div>

                                {/* The Rope */}
                                <div className="h-4 w-64 rope-texture rounded shadow-inner mx-[-10px] relative z-0 flex items-center justify-center">
                                    {/* Center Flag */}
                                    <div className="absolute w-1 h-8 bg-red-600 top-[-10px]">
                                        <div className="w-4 h-3 bg-red-600 absolute top-0 right-[-4px]"></div>
                                    </div>
                                </div>

                                {/* Right Team (Blue) */}
                                <div className="flex flex-col items-center relative z-10">
                                    <div className={`text-5xl ${!isRedTurn ? 'animate-bounce' : ''}`}>ü§†</div>
                                    <div className="font-bold text-blue-600 bg-white px-2 rounded shadow mt-1 text-xs">BIRU</div>
                                </div>
                            </div>

                            {/* Win Zones */}
                            <div className="absolute left-4 top-0 bottom-0 w-2 bg-red-300 rounded opacity-50 border-2 border-red-500 border-dashed"></div>
                            <div className="absolute right-4 top-0 bottom-0 w-2 bg-blue-300 rounded opacity-50 border-2 border-blue-500 border-dashed"></div>
                        </div>

                        {/* Turn Indicator */}
                        <div className="text-center mt-4">
                            <span className={`px-6 py-2 rounded-full text-white font-bold text-lg shadow-lg animate-pulse ${isRedTurn ? 'bg-red-500' : 'bg-blue-500'}`}>
                                Giliran: {isRedTurn ? 'TIM MERAH' : 'TIM BIRU'}
                            </span>
                        </div>
                    </div>

                    {/* QUESTION CARD */}
                    <div className="flex-grow flex flex-col items-center justify-center p-4 bg-gradient-to-b from-blue-50 to-white">
                        
                        {/* Visual Boxes */}
                        <div className="w-full max-w-2xl bg-white rounded-3xl shadow-xl border-4 border-indigo-100 p-4 mb-6 pop-in relative">
                            
                            {/* Feedback Overlay */}
                            {feedback && (
                                <div className={`absolute inset-0 z-50 rounded-2xl flex items-center justify-center bg-white/90 backdrop-blur-sm ${feedback === 'correct' ? 'text-green-500' : 'text-red-500'}`}>
                                    <div className="text-center animate-bounce">
                                        <div className="text-8xl">{feedback === 'correct' ? '‚ú®' : '‚ùå'}</div>
                                        <div className="font-bold text-3xl mt-2">{feedback === 'correct' ? 'BENAR!' : 'COBA LAGI'}</div>
                                    </div>
                                </div>
                            )}

                            <div className="flex flex-col md:flex-row gap-4 items-stretch">
                                {/* Box A */}
                                <div className="flex-1 bg-orange-50 rounded-2xl border-2 border-orange-200 p-4 flex flex-col items-center relative group">
                                    <span className="absolute -top-3 -left-3 bg-orange-500 text-white w-8 h-8 rounded-full flex items-center justify-center font-bold shadow">a</span>
                                    <div className="flex flex-wrap justify-center gap-1 mb-2 min-h-[80px] items-center">
                                        {[...Array(currentQ.countA)].map((_, i) => <IconComp key={i} color={currentQ.colorA} />)}
                                    </div>
                                    <p className="text-gray-600 font-medium text-center text-sm md:text-base">
                                        Ada <span className="font-bold text-orange-600 text-xl mx-1">{currentQ.countA}</span> 
                                        {objName} berwarna {currentQ.nameA}.
                                    </p>
                                </div>

                                {/* Plus Sign */}
                                <div className="flex items-center justify-center">
                                    <div className="w-10 h-10 bg-gray-100 rounded-full flex items-center justify-center font-bold text-2xl text-gray-400 shadow-inner">+</div>
                                </div>

                                {/* Box B */}
                                <div className="flex-1 bg-purple-50 rounded-2xl border-2 border-purple-200 p-4 flex flex-col items-center relative group">
                                    <span className="absolute -top-3 -left-3 bg-purple-500 text-white w-8 h-8 rounded-full flex items-center justify-center font-bold shadow">b</span>
                                    <div className="flex flex-wrap justify-center gap-1 mb-2 min-h-[80px] items-center">
                                        {[...Array(currentQ.countB)].map((_, i) => <IconComp key={i+99} color={currentQ.colorB} />)}
                                    </div>
                                    <p className="text-gray-600 font-medium text-center text-sm md:text-base">
                                        Ada <span className="font-bold text-purple-600 text-xl mx-1">{currentQ.countB}</span>
                                        {objName} berwarna {currentQ.nameB}.
                                    </p>
                                </div>
                            </div>

                            <div className="mt-6 text-center bg-indigo-50 p-3 rounded-xl border border-indigo-100 flex items-center justify-center gap-3">
                                <h3 className="text-2xl font-bold text-indigo-800">
                                    Semuanya ada <span className="inline-block w-16 border-b-4 border-indigo-400 text-transparent">?</span> {objName}.
                                </h3>
                                <button onClick={readQuestion} className="bg-white p-2 rounded-full shadow text-blue-500 hover:bg-blue-50" title="Dengarkan Soal">
                                    <i className="fa-solid fa-volume-high"></i>
                                </button>
                            </div>
                        </div>

                        {/* Numpad */}
                        <div className="grid grid-cols-5 gap-3 md:gap-4 w-full max-w-xl">
                            {[1, 2, 3, 4, 5, 6, 7, 8, 9, 10].map((num) => (
                                <button 
                                    key={num}
                                    onClick={() => handleAnswer(num)}
                                    className={`
                                        py-4 rounded-2xl font-bold text-2xl md:text-3xl shadow-lg transform transition active:scale-90
                                        ${isRedTurn 
                                            ? 'bg-red-100 text-red-600 hover:bg-red-200 border-b-4 border-red-300' 
                                            : 'bg-blue-100 text-blue-600 hover:bg-blue-200 border-b-4 border-blue-300'
                                        }
                                    `}
                                >
                                    {num}
                                </button>
                            ))}
                        </div>

                    </div>

                    {/* Footer */}
                    <footer className="bg-white border-t-4 border-yellow-400 py-4">
                        <div className="container mx-auto text-center">
                            <p className="text-gray-600 text-sm md:text-base font-medium">
                                Dibuat oleh <span className="font-bold text-yellow-600">Abdul Salim Owner folderosn.com</span>
                            </p>
                            <a href="https://pakabdulsalim.blogspot.com/" target="_blank" className="inline-block mt-1 text-blue-500 hover:text-blue-700 font-bold hover:underline transition-all text-sm">
                                Kunjungi: https://pakabdulsalim.blogspot.com
                            </a>
                        </div>
                    </footer>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
