<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Penjumlahan Ceria - Kelas 1 SD</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    
    <!-- Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- Font & Icons -->
    <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;600;700&family=Varela+Round&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Confetti -->
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

    <style>
        body {
            font-family: 'Varela Round', sans-serif;
            background-color: #fdf2f8; /* Pink tint */
            background-image: radial-gradient(#fbcfe8 2px, transparent 2px);
            background-size: 24px 24px;
            overflow: hidden;
            touch-action: none;
            user-select: none;
        }
        
        .font-title { font-family: 'Fredoka', sans-serif; }

        /* Button Hover Effects */
        .option-btn {
            transition: all 0.1s;
            border-bottom-width: 6px;
        }
        .option-btn:active {
            transform: translateY(4px);
            border-bottom-width: 2px;
        }

        @keyframes pop {
            0% { transform: scale(0.5); opacity: 0; }
            60% { transform: scale(1.1); opacity: 1; }
            100% { transform: scale(1); }
        }
        .animate-pop { animation: pop 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards; }

        @keyframes slide-up {
            from { transform: translateY(20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        .animate-slide { animation: slide-up 0.5s ease-out forwards; }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
        }
        .animate-shake { animation: shake 0.4s; }
    </style>
</head>
<body class="flex flex-col h-screen">
    <div id="root" class="flex-grow h-full"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // --- 1. ASSETS: SVG ICONS ---
        const Icons = {
            Apple: ({ color }) => (
                <svg viewBox="0 0 100 100" className="w-full h-full drop-shadow-sm">
                    <path d="M50 20 Q 65 5 80 20 Q 95 35 85 65 Q 75 95 50 90 Q 25 95 15 65 Q 5 35 20 20 Q 35 5 50 20" fill={color} />
                    <path d="M50 20 Q 50 5 55 10" stroke="#4a7c59" strokeWidth="4" fill="none" />
                </svg>
            ),
            Car: ({ color }) => (
                <svg viewBox="0 0 100 60" className="w-full h-full drop-shadow-sm">
                    <path d="M10 35 L20 15 L75 15 L85 35 L90 35 Q 95 35 95 45 L95 50 L5 50 L5 45 Q 5 35 10 35 Z" fill={color} />
                    <circle cx="25" cy="50" r="8" fill="#333" />
                    <circle cx="75" cy="50" r="8" fill="#333" />
                </svg>
            ),
            Star: ({ color }) => (
                <svg viewBox="0 0 100 100" className="w-full h-full drop-shadow-sm">
                    <polygon points="50,5 61,35 95,35 68,55 79,90 50,70 21,90 32,55 5,35 39,35" fill={color} stroke="rgba(0,0,0,0.1)" strokeWidth="2" />
                </svg>
            ),
            Ball: ({ color }) => (
                <svg viewBox="0 0 100 100" className="w-full h-full drop-shadow-sm">
                    <circle cx="50" cy="50" r="45" fill={color} />
                    <path d="M5 50 Q 50 20 95 50" fill="none" stroke="rgba(255,255,255,0.5)" strokeWidth="4" />
                </svg>
            ),
            Cookie: ({ color }) => (
                <svg viewBox="0 0 100 100" className="w-full h-full drop-shadow-sm">
                    <circle cx="50" cy="50" r="40" fill={color} />
                    <circle cx="30" cy="40" r="5" fill="rgba(0,0,0,0.2)" />
                    <circle cx="70" cy="30" r="5" fill="rgba(0,0,0,0.2)" />
                    <circle cx="50" cy="70" r="5" fill="rgba(0,0,0,0.2)" />
                </svg>
            ),
            Flower: ({ color }) => (
                <svg viewBox="0 0 100 100" className="w-full h-full drop-shadow-sm">
                    <circle cx="30" cy="30" r="15" fill={color} />
                    <circle cx="70" cy="30" r="15" fill={color} />
                    <circle cx="30" cy="70" r="15" fill={color} />
                    <circle cx="70" cy="70" r="15" fill={color} />
                    <circle cx="50" cy="50" r="20" fill="#facc15" />
                </svg>
            )
        };

        // --- 2. GAME LOGIC ---
        
        const OBJECT_TYPES = ['Apple', 'Car', 'Star', 'Ball', 'Cookie', 'Flower'];
        const COLORS = ["#ef4444", "#3b82f6", "#22c55e", "#eab308", "#a855f7", "#f97316", "#ec4899"];

        const getRandom = (arr) => arr[Math.floor(Math.random() * arr.length)];
        const getRandomInt = (min, max) => Math.floor(Math.random() * (max - min + 1)) + min;

        const generateQuestions = (count = 5) => {
            let quests = [];
            for (let i = 0; i < count; i++) {
                const type = getRandom(OBJECT_TYPES);
                const color = getRandom(COLORS);
                
                // Generate numbers (Total max 20)
                const numA = getRandomInt(1, 10);
                const numB = getRandomInt(1, 10);
                const total = numA + numB;

                // Generate Options (1 Correct, 2 Distractors)
                const opts = new Set([total]);
                while(opts.size < 3) {
                    let distractor = getRandomInt(Math.max(2, total - 5), Math.min(20, total + 5));
                    if (distractor !== total) opts.add(distractor);
                }

                quests.push({
                    id: i + 1,
                    type,
                    color,
                    numA,
                    numB,
                    total,
                    options: Array.from(opts).sort((a, b) => a - b)
                });
            }
            return quests;
        };

        // FUNGSI SUARA (TTS)
        const speak = (text) => {
            if ('speechSynthesis' in window) {
                window.speechSynthesis.cancel();
                const utterance = new SpeechSynthesisUtterance(text);
                utterance.lang = 'id-ID';
                utterance.rate = 0.9;
                utterance.volume = 1.0;
                window.speechSynthesis.speak(utterance);
            }
        };

        // --- 3. COMPONENTS ---

        // Visual Object Container
        const ObjectBox = ({ type, color, count, label }) => {
            const Icon = Icons[type];
            return (
                <div className="bg-white/90 p-2 rounded-3xl border-[6px] border-pink-300 shadow-lg flex flex-col items-center w-full h-48 md:h-64 relative overflow-hidden">
                    <div className="absolute top-0 left-0 px-4 py-1 rounded-br-2xl font-bold text-sm text-white bg-pink-400 shadow-md z-10">
                        {label}
                    </div>
                    
                    {/* Counter Badge */}
                    <div className="absolute top-2 right-2 w-10 h-10 bg-pink-100 rounded-full flex items-center justify-center text-pink-600 font-black border-2 border-pink-200 shadow-sm z-10">
                        {count}
                    </div>

                    <div className="flex flex-wrap justify-center gap-2 content-center h-full w-full p-4 overflow-hidden pt-8">
                        {[...Array(count)].map((_, i) => (
                            <div key={i} className="w-8 h-8 md:w-12 md:h-12 animate-pop drop-shadow-sm" style={{animationDelay: `${i * 0.05}s`}}>
                                <Icon color={color} />
                            </div>
                        ))}
                    </div>
                </div>
            );
        };

        // --- 4. MAIN APP ---
        const App = () => {
            const [screen, setScreen] = useState('start');
            const [questions, setQuestions] = useState([]);
            const [qIndex, setQIndex] = useState(0);
            const [feedback, setFeedback] = useState(null); // null, correct, wrong
            const [score, setScore] = useState(0);

            useEffect(() => {
                window.speechSynthesis.getVoices(); // Preload voices
                setQuestions(generateQuestions());
            }, []);

            const currentQ = questions[qIndex];

            // Play audio when question changes
            useEffect(() => {
                if (screen === 'playing' && currentQ) {
                    setTimeout(() => {
                        speak(`Berapa hasil ${currentQ.numA} ditambah ${currentQ.numB}?`);
                    }, 500);
                }
            }, [qIndex, screen]);

            const handleStart = () => {
                speak("Ayo belajar menjumlahkan!");
                setQuestions(generateQuestions(5));
                setQIndex(0);
                setScore(0);
                setFeedback(null);
                setScreen('playing');
            };

            const handleAnswer = (val) => {
                if (feedback) return; // Prevent multiple clicks

                if (val === currentQ.total) {
                    setFeedback('correct');
                    setScore(s => s + 1);
                    speak("Benar! Kamu hebat.");
                    confetti({ particleCount: 100, spread: 70, origin: { y: 0.6 } });
                    
                    setTimeout(() => {
                        setFeedback(null);
                        if (qIndex < 4) {
                            setQIndex(prev => prev + 1);
                        } else {
                            setScreen('finish');
                            speak("Selamat! Kamu sudah menyelesaikan semua soal.");
                        }
                    }, 2000);
                } else {
                    setFeedback('wrong');
                    speak("Ups, salah. Coba hitung lagi.");
                    setTimeout(() => setFeedback(null), 1000);
                }
            };

            // START SCREEN
            if (screen === 'start') {
                return (
                    <div className="h-full flex flex-col items-center justify-center p-4 text-center relative bg-pink-50">
                        <h1 className="text-5xl md:text-7xl font-black text-pink-600 mb-6 font-title drop-shadow-xl tracking-wide transform -rotate-2">
                            PENJUMLAHAN CERIA
                        </h1>
                        <p className="text-2xl text-gray-600 mb-10 max-w-lg font-bold">
                            Hitung jumlah bendanya dan pilih jawaban yang benar!
                        </p>
                        
                        {/* Decoration */}
                        <div className="flex gap-4 mb-12 animate-bounce">
                            <div className="w-16 h-16 text-red-500"><Icons.Apple color="#ef4444"/></div>
                            <div className="text-4xl font-black text-gray-400 mt-4">+</div>
                            <div className="w-16 h-16 text-blue-500"><Icons.Car color="#3b82f6"/></div>
                        </div>

                        <button onClick={handleStart} className="bg-green-500 hover:bg-green-600 text-white text-3xl font-black py-5 px-20 rounded-full shadow-[0_8px_0_rgb(21,128,61)] transform transition hover:scale-105 active:scale-95 active:shadow-none active:translate-y-2 flex items-center gap-4 border-4 border-green-400">
                            <i className="fa-solid fa-play"></i> MULAI
                        </button>
                    </div>
                );
            }

            // FINISH SCREEN
            if (screen === 'finish') {
                return (
                    <div className="h-full flex flex-col items-center justify-center p-4 text-center bg-yellow-50">
                        <div className="text-9xl mb-8 animate-bounce">üèÜ</div>
                        <h1 className="text-6xl font-black text-orange-600 mb-4 font-title">SELESAI!</h1>
                        <p className="text-3xl text-gray-700 mb-4 font-bold">Skor Kamu: {score} / 5</p>
                        <p className="text-xl text-gray-500 mb-10 font-medium">Kamu pintar sekali berhitung!</p>
                        
                        <button onClick={handleStart} className="bg-pink-500 hover:bg-pink-600 text-white text-xl font-bold py-4 px-12 rounded-full shadow-[0_6px_0_rgb(190,24,93)] transform transition hover:scale-105 active:scale-95 active:shadow-none active:translate-y-2 flex items-center gap-3 border-4 border-pink-400">
                            <i className="fa-solid fa-rotate-right"></i> Main Lagi
                        </button>
                        
                        <div className="mt-16 bg-white p-4 rounded-xl shadow-sm border-2 border-orange-100">
                            <p className="text-gray-500 text-sm font-bold">
                                Dibuat oleh <span className="text-pink-600">Abdul Salim Owner folderosn.com</span>
                            </p>
                            <a href="https://pakabdulsalim.blogspot.com/" target="_blank" className="text-blue-500 text-sm font-bold hover:underline">Kunjungi: https://pakabdulsalim.blogspot.com</a>
                        </div>
                    </div>
                );
            }

            // PLAYING SCREEN
            return (
                <div className="flex flex-col h-full bg-pink-50 overflow-hidden relative">
                    
                    {/* Header */}
                    <div className="bg-white p-4 shadow-md z-20 flex justify-between items-center border-b-4 border-pink-200">
                        <button onClick={() => setScreen('start')} className="text-gray-500 hover:text-gray-700 bg-gray-100 p-3 rounded-xl shadow active:scale-95">
                            <i className="fa-solid fa-house text-2xl"></i>
                        </button>
                        <h2 className="text-3xl font-black text-pink-600 font-title tracking-wide drop-shadow-sm">Soal {qIndex + 1} / 5</h2>
                        <button onClick={() => speak(`Berapa hasil ${currentQ.numA} ditambah ${currentQ.numB}?`)} className="bg-white p-3 rounded-full shadow text-pink-500 hover:text-pink-700 border-2 border-pink-100 active:scale-95">
                            <i className="fa-solid fa-volume-high text-2xl"></i>
                        </button>
                    </div>

                    {/* Main Content */}
                    <div className="flex-grow flex flex-col items-center justify-center p-2 gap-6 w-full max-w-5xl mx-auto overflow-y-auto">
                        
                        {/* Visual Row */}
                        <div className="flex w-full gap-4 items-center justify-center px-4 mt-4 animate-slide">
                            <div className="flex-1 transform rotate-[-2deg]">
                                <ObjectBox 
                                    type={currentQ.type} 
                                    color={currentQ.color} 
                                    count={currentQ.numA} 
                                    label="Kelompok A" 
                                />
                            </div>
                            
                            <div className="text-6xl font-black text-gray-300 hidden md:block shadow-sm">+</div>
                            
                            <div className="flex-1 transform rotate-[2deg]">
                                <ObjectBox 
                                    type={currentQ.type} 
                                    color={currentQ.color} 
                                    count={currentQ.numB} 
                                    label="Kelompok B" 
                                />
                            </div>
                        </div>

                        {/* Question Text */}
                        <div className="text-center">
                            <h3 className="text-2xl md:text-4xl font-bold text-gray-700 mb-4">
                                <span className="bg-white px-4 py-1 rounded-lg border-2 border-pink-200 shadow-sm mx-2">{currentQ.numA}</span> 
                                + 
                                <span className="bg-white px-4 py-1 rounded-lg border-2 border-pink-200 shadow-sm mx-2">{currentQ.numB}</span> 
                                = <span className="text-pink-500">?</span>
                            </h3>
                        </div>

                        {/* Answer Options */}
                        <div className="grid grid-cols-3 gap-4 md:gap-8 w-full max-w-2xl px-4 mb-4">
                            {currentQ.options.map((opt, idx) => (
                                <button 
                                    key={idx}
                                    onClick={() => handleAnswer(opt)}
                                    className="option-btn bg-white hover:bg-pink-50 text-pink-600 border-b-[6px] border-pink-300 hover:border-pink-400 rounded-2xl py-4 text-4xl md:text-6xl font-black shadow-lg active:bg-pink-100 w-full"
                                >
                                    {opt}
                                </button>
                            ))}
                        </div>

                    </div>

                    {/* Feedback Overlay */}
                    {feedback === 'correct' && (
                        <div className="fixed inset-0 flex items-center justify-center bg-white/80 z-50 animate-pop pointer-events-none">
                            <div className="text-center transform scale-125">
                                <div className="text-9xl mb-4">‚ú®</div>
                                <h2 className="text-6xl font-black text-green-500 font-title drop-shadow-md">BENAR!</h2>
                            </div>
                        </div>
                    )}
                    {feedback === 'wrong' && (
                        <div className="fixed inset-0 flex items-center justify-center bg-white/80 z-50 animate-pop pointer-events-none">
                            <div className="bg-red-50 px-12 py-8 rounded-[2rem] border-8 border-red-200 text-center shadow-2xl animate-shake">
                                <div className="text-8xl mb-4">üò¢</div>
                                <h2 className="text-4xl font-black text-red-500 font-title">Coba Lagi!</h2>
                            </div>
                        </div>
                    )}

                    {/* Footer */}
                    <footer className="bg-white border-t-4 border-pink-200 py-4 z-20">
                        <div className="container mx-auto text-center">
                            <p className="text-gray-500 text-xs md:text-sm font-bold">
                                Dibuat oleh <span className="text-pink-500">Abdul Salim Owner folderosn.com</span>
                            </p>
                            <a href="https://pakabdulsalim.blogspot.com/" target="_blank" className="inline-block text-blue-500 hover:text-blue-700 font-bold hover:underline transition-all text-xs mt-1">
                                Kunjungi: https://pakabdulsalim.blogspot.com
                            </a>
                        </div>
                    </footer>

                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
